<!DOCTYPE html>


<html lang="zh-CN">


<head>
  <meta charset="utf-8" />
    
  <meta name="description" content="我是一位牧码人，快放码过来，" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>
     D4C的世界
  </title>
  <meta name="generator" content="hexo-theme-ayer">
  
  <link rel="shortcut icon" href="/favicon.ico" />
  
  
<link rel="stylesheet" href="/dist/main.css">

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css">

  
<link rel="stylesheet" href="/css/custom.css">

  
  
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

  
  

  

<link rel="alternate" href="/atom.xml" title="D4C的世界" type="application/atom+xml">
</head>

</html>

<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
      
      <a class="forkMe" href="https://gitee.com/dancer4code"
        target="_blank"><img width="149" height="149" src="/images/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover5.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">D4C的世界</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['面朝大海，春暖花开', '愿你一生努力，一生被爱', '想要的都拥有，得不到的都释怀'],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-mysql/win10下安装多个mysql"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/20/mysql/win10%E4%B8%8B%E5%AE%89%E8%A3%85%E5%A4%9A%E4%B8%AAmysql/"
    >win10下安装多个mysql</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/20/mysql/win10%E4%B8%8B%E5%AE%89%E8%A3%85%E5%A4%9A%E4%B8%AAmysql/" class="article-date">
  <time datetime="2020-07-20T14:36:00.000Z" itemprop="datePublished">2020-07-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="1-下载解压版mysql"><a href="#1-下载解压版mysql" class="headerlink" title="1.下载解压版mysql"></a>1.下载解压版mysql</h1><p>我用的是<code>mysql-5.7.24-winx64.zip</code></p>
<h1 id="2-解压到一个目录下"><a href="#2-解压到一个目录下" class="headerlink" title="2.解压到一个目录下"></a>2.解压到一个目录下</h1><p>我的目录如下<br><img src="https://upload-images.jianshu.io/upload_images/19382524-c8f4ab0246e8c3b3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="3-在MySQL安装目录下创建-my-ini-文件"><a href="#3-在MySQL安装目录下创建-my-ini-文件" class="headerlink" title="3.在MySQL安装目录下创建  my.ini 文件"></a>3.在MySQL安装目录下创建  <code>my.ini</code> 文件</h1><p><strong>my.ini</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">#skip-grant-tables</span><br><span class="line">basedir&#x3D;E:\\developer\\mysql\\mysql-5.7.24-winx64-3306\\bin</span><br><span class="line">datadir&#x3D;E:\\developer\\mysql\\mysql-5.7.24-winx64-3306\\data</span><br><span class="line">port&#x3D;3306</span><br><span class="line">server-id&#x3D;1</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line">log-bin&#x3D;E:\\developer\\mysql\\mysql-5.7.24-winx64-3306\\logs\\mysql-bin</span><br><span class="line">binlog-format&#x3D;ROW</span><br><span class="line">explicit_defaults_for_timestamp&#x3D;1</span><br><span class="line">lc-messages-dir&#x3D; &quot;E:\\developer\\mysql\\mysql-5.7.24-winx64-3306\\share&quot;</span><br></pre></td></tr></table></figure>
<h1 id="4-初始化"><a href="#4-初始化" class="headerlink" title="4.初始化"></a>4.初始化</h1><p>进入bin目录下执行</p>
<blockquote>
<p>注意：一定要用管理员权限执行</p>
</blockquote>
<p><strong>执行</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize --user&#x3D;mysql --console</span><br></pre></td></tr></table></figure>
<p>会打印出临时密码：<br><img src="https://upload-images.jianshu.io/upload_images/19382524-8768409dde3f1dc5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>一会重置密码是要用到</p>
<h1 id="5-安装成自定义名称的服务"><a href="#5-安装成自定义名称的服务" class="headerlink" title="5.安装成自定义名称的服务"></a>5.安装成自定义名称的服务</h1><p>安装并创建服务：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld install mysql3306 --defaults-file&#x3D;&quot;E:\developer\mysql\mysql-5.7.24-winx64-3306\my.ini&quot;</span><br></pre></td></tr></table></figure>
<p>安装成功后会提示<br><img src="https://upload-images.jianshu.io/upload_images/19382524-407e191a3252a3b5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>安装成功后的目录结构如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-c2a6694cf40fae05.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>脚注<a href="%E6%B5%8B%E8%AF%95%E8%84%9A%E6%B3%A8">^1</a></p>
<h1 id="6-修改密码"><a href="#6-修改密码" class="headerlink" title="6.修改密码"></a>6.修改密码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#启动服务</span><br><span class="line">net start mysql3306</span><br><span class="line"></span><br><span class="line">mysql3307 服务正在启动 .</span><br><span class="line">mysql3307 服务已经启动成功。</span><br><span class="line"></span><br><span class="line">#登入mysql </span><br><span class="line">mysql -uroot -P3306 -pv7xMqnqlEy,x</span><br><span class="line"></span><br><span class="line">#成功登录后,修改密码</span><br><span class="line">set password &#x3D; password(&#39;d4c123456&#39;);</span><br><span class="line"></span><br><span class="line"># mysql 8.0设置密码</span><br><span class="line">alter user user() identified by &quot;d4c123456&quot;;</span><br></pre></td></tr></table></figure>

<p>#7.另一个mysql同样的操作</p>
<p>#8 navicat连接错误<br>在navicat链接mysql8以后的版本时，会出现2059的错误，<br>这个错误出现的原因是在mysql8之前的版本中加密规则为mysql_native_password，而在mysql8以后的加密规则为</p>
<p>caching_sha2_password。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a><strong>解决方案</strong></h3><p><strong>在mysql的命令行里面输入</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line">ALTER USER &#39;root&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;d4c123456&#39;;</span><br></pre></td></tr></table></figure>

<p>###授权所有的ip都能访问mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;%&#39;  IDENTIFIED BY &#39;d4c123456&#39;  WITH GRANT OPTION;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-mysql/sql常用函数"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/19/mysql/sql%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/"
    >sql常用函数</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/19/mysql/sql%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0/" class="article-date">
  <time datetime="2020-07-19T14:36:00.000Z" itemprop="datePublished">2020-07-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="一、字符函数"><a href="#一、字符函数" class="headerlink" title="一、字符函数"></a>一、字符函数</h1><ol>
<li>LENGTH </li>
</ol>
<p>#获取参数值的字节个数</p>
<p>SELECT LENGTH (‘lala’) ;</p>
<p>结果： 4</p>
<ol start="2">
<li>CONCAT </li>
</ol>
<p>#拼接字符串</p>
<p>SELECT CONCAT (‘asd’ , ‘we’ );</p>
<p>结果： asdwe</p>
<ol start="3">
<li>UPPER</li>
</ol>
<p>#将参数全部变为大写</p>
<p>SELECT UPPER(‘ abcd’ );</p>
<p>结果:   ABCD</p>
<ol start="3">
<li>LOWER</li>
</ol>
<h1 id="将参数全部变为小写"><a href="#将参数全部变为小写" class="headerlink" title="将参数全部变为小写"></a>将参数全部变为小写</h1><p>SELECT LOWER(‘ ABCD’ );</p>
<p>结果:   abcd</p>
<ol start="4">
<li>SUBSTR</li>
</ol>
<p>#索引从1开始，返回指定位置及其之后的字符串</p>
<p>SELECT SUBSTR( ‘ ABCD’ , 2 ); </p>
<p>结果：BCD</p>
<p>#截取从指定索引处（第二个参数）开始，获取索引位置及其后指定字符长度的字符串（第三个参数）</p>
<p>SELECT SUBSTR( ‘ ABCD’ , 1,3 ); </p>
<p>结果：ABC</p>
<ol start="5">
<li>INSTR </li>
</ol>
<h1 id="返回第二个参数在第一个参数中第一次出现的位置，若没有出现，则返回0"><a href="#返回第二个参数在第一个参数中第一次出现的位置，若没有出现，则返回0" class="headerlink" title="返回第二个参数在第一个参数中第一次出现的位置，若没有出现，则返回0"></a>返回第二个参数在第一个参数中第一次出现的位置，若没有出现，则返回0</h1><p>SELECT INSTR(‘ABCD’ , ‘CD’)</p>
<p>结果：  3</p>
<p>SELECT INSTR(‘ABCD’ , ‘E’)</p>
<p>结果：  0</p>
<ol start="6">
<li>TRIM</li>
</ol>
<p>#去除首尾指定的字符，若没有指定，则表示去除空格</p>
<p>SELECT TRIM ( ‘#’ , ‘###acd##sas###’);</p>
<p>结果：  acd##sas</p>
<ol start="7">
<li>LPAD </li>
</ol>
<p>#用指定的字符实现左填充指定长度，同时也是结果的最终长度</p>
<p>SELECT LPAD( ‘abc’ , 4 , ‘#’’);</p>
<p>结果:  #ABC</p>
<ol start="8">
<li>RPAD </li>
</ol>
<p>#用指定的字符实现右填充指定长度，同时也是结果的最终长度</p>
<p>SELECT LPAD( ‘ABC’ , 4 , ‘#’);</p>
<p>结果:  ABC#</p>
<p>SELECT LPAD( ‘ABC’ , 2 , ‘#’);</p>
<p>结果:  AB</p>
<ol start="9">
<li>REPLACE</li>
</ol>
<p>#替换所有的指定的字符串为另一个字符串</p>
<p>SELECT REPLACE( ‘ABCBCD’ , ‘BC’ ,’#’ ); </p>
<p>结果: A##D</p>
<p>二、数学函数</p>
<ol>
<li>ROUND</li>
</ol>
<p>#四舍五入</p>
<p> SELECT ROUND(-1.55);</p>
<p>结果：  -2 </p>
<p>#保留指定小数的位数</p>
<p>SELECT ROUND (1.547,2);</p>
<p>结果：  1.54</p>
<ol start="2">
<li>CEIL </li>
</ol>
<p>#向上取整，返回大于等于该参数的最小整数</p>
<p>SELECT CEIL (-1.0002);</p>
<p>结果：  -1</p>
<ol start="3">
<li>FLOOR</li>
</ol>
<p>#向下取整，返回小于等于该参数的最大整数</p>
<p>SELECT CEIL (9.99999);</p>
<p>结果：  9</p>
<ol start="4">
<li>TRUNCATE</li>
</ol>
<p>#截断</p>
<p>SELECT TRUNCATE (1.6699,2);</p>
<p>结果:  1.66</p>
<ol start="5">
<li>MOD</li>
</ol>
<p>#取模</p>
<p>SELECT MOD(-10,-3)</p>
<p>结果:  -1</p>
<p>三、日期函数</p>
<ol>
<li>NOW</li>
</ol>
<p>#返回当前系统日期+时间</p>
<p>SELECT NOW();</p>
<ol start="2">
<li>CURDATE</li>
</ol>
<p>#返回当前系统时间，不包含时间</p>
<p>SELECT CURDATE();</p>
<ol start="3">
<li>CURTIME </li>
</ol>
<p>#返回当前时间，不包含日期</p>
<p>SELECT CURTIME();</p>
<ol start="4">
<li>MONTHNAME , DAYNAME  等</li>
</ol>
<p>#返回日期的英文名字</p>
<p>SELECT DAYNAME(NOW());</p>
<ol start="5">
<li>STR_TO_DATE</li>
</ol>
<p>#将字符串通过指定的格式转化为日期</p>
<p>SELECT STR_TO_DATE(‘4-3#1992’, ‘%m-%d#%Y’);</p>
<p>结果：1992-04-03</p>
<ol start="6">
<li>DATE_FORMAT</li>
</ol>
<p>#将日期转化为指定格式字符串</p>
<p>SELECT DATE_FORMAT(NOW(), ‘%m#%d#%Y’);</p>
<p>结果： 04#27#2019</p>
<p>三、其他函数</p>
<ol>
<li>SELECT VERSION()</li>
</ol>
<p>#获取sql的版本号</p>
<ol start="2">
<li>SELECT DATABASE()</li>
</ol>
<p>#获取当前所在数据库名</p>
<p>3)SELECT USER()</p>
<p>#获取登陆用户名</p>
<p>四、流程控制函数</p>
<ol>
<li>if</li>
</ol>
<p>#一共三个参数，若第一个参数代表的表达式值为true, 则执行第二个参数代表的表达式，否则执行第三个参数代表的表达式</p>
<p>SELECT IF (10 &gt; 5 , ‘大’ , ‘小’ )；</p>
<p>结果： 大</p>
<ol start="2">
<li>case</li>
</ol>
<p>用法一：</p>
<p>#相当于switch case</p>
<p>CASE 要判断的字段或者表达式</p>
<p>WHEN 常量1 THEN 要显示的值1或者与语句1</p>
<p>WHEN 常量2   THEN 要显示的值2或者与语句2</p>
<p>WHEN 常量3 THEN 要显示的值3或者与语句3</p>
<p>ELSE  要显示的值x或者与语句x</p>
<p>END</p>
<p>用法二：</p>
<p>#相当于多重if</p>
<p>#相当于switch case</p>
<p>CASE</p>
<p>WHEN 条件1 THEN 要显示的值1或者与语句1</p>
<p>WHEN 条件2   THEN 要显示的值2或者与语句2</p>
<p>WHEN 条件3 THEN 要显示的值3或者与语句3</p>
<p>ELSE  要显示的值x或者与语句x</p>
<p>转载自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/winter-bamboo/p/10779466.html">SQL常用函数</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-mysql/mysql一些常用的操作"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/17/mysql/mysql%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E6%93%8D%E4%BD%9C/"
    >mysql一些常用的操作</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/17/mysql/mysql%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E7%9A%84%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2020-07-17T14:36:00.000Z" itemprop="datePublished">2020-07-17</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h1><p><code>mysql 解压版安装</code></p>
<ul>
<li>1.解压（windows7）</li>
<li>2.进入到bin目录<br><code>&gt;mysqld install mysql</code>(服务名称，随便起 默认mysql)<br><code>&gt;mysqld --initialize</code>(5.6的版本不用这步 ，5.7的需要这布初始化data文件夹)</li>
<li>3<br><code>&gt;net start mysql</code>启动服务</li>
<li>4.&gt;登陆<br><code>&gt;mysql -hlocalhost -uroot -p</code>(data文件夹下有一个.err结尾的文件。里面存放着一个临时登录密码)</li>
</ul>
<p><code>一个电脑中安装多个mysql</code><br><code>mysqld install mysql2</code>只是这一步不一样，其他一样</p>
<p><strong>my.ini文件</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">innodb_force_recovery &#x3D; 1</span><br><span class="line"># 设置3306端口</span><br><span class="line">port&#x3D;3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir&#x3D;D:\\developer\\mysql-5.6.34-winx64   # 切记此处一定要用双斜杠\\，单斜杠我这里会出错，不过看别人的教程，有的是单斜杠。自己尝试吧</span><br><span class="line"># 设置mysql数据库的数据的存放目录</span><br><span class="line">datadir&#x3D;D:\\developer\\mysql-5.6.34-winx64\\Data   # 此处同上</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections&#x3D;200</span><br><span class="line"># 允许连接失败的次数。这是为了防止有人从该主机试图攻击数据库系统</span><br><span class="line">max_connect_errors&#x3D;10</span><br><span class="line"># 服务端使用的字符集默认为UTF8</span><br><span class="line">character-set-server&#x3D;utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine&#x3D;INNODB</span><br><span class="line"># 默认使用“mysql_native_password”插件认证</span><br><span class="line">default_authentication_plugin&#x3D;mysql_native_password</span><br></pre></td></tr></table></figure>

<h1 id="二、开启binlog日志文件"><a href="#二、开启binlog日志文件" class="headerlink" title="二、开启binlog日志文件"></a>二、开启binlog日志文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">log-bin&#x3D;log-bin\\mysql_bin.log</span><br><span class="line">#binlog日志格式，mysql默认采用statement，建议使用mixed</span><br><span class="line">#mysql复制主要有三种方式：</span><br><span class="line">#基于SQL语句的复制(statement-based replication, SBR)，</span><br><span class="line">#基于行的复制(row-based replication, RBR)，</span><br><span class="line">#混合模式复制(mixed-based replication, MBR)。</span><br><span class="line">#对应的，binlog的格式也有三种：STATEMENT，ROW，MIXED。</span><br><span class="line">binlog_format&#x3D;MIXED   </span><br><span class="line">#binlog过期清理时间                     </span><br><span class="line">expire_logs_days&#x3D;10   </span><br><span class="line">#binlog每个日志文件大小                       </span><br><span class="line">max_binlog_size&#x3D; 100m   </span><br><span class="line">#binlog缓存大小                   </span><br><span class="line">binlog_cache_size&#x3D; 4m   </span><br><span class="line">最大binlog缓存大小                      </span><br><span class="line">max_binlog_cache_size&#x3D; 512m                     </span><br><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set&#x3D;utf8</span><br><span class="line">[client]</span><br><span class="line"># 设置mysql客户端连接服务端时默认使用的端口</span><br><span class="line">port&#x3D;3306</span><br><span class="line">default-character-set&#x3D;utf8</span><br></pre></td></tr></table></figure>
<h1 id="三、MySQL修改root密码的4种方法-以windows为例"><a href="#三、MySQL修改root密码的4种方法-以windows为例" class="headerlink" title="三、MySQL修改root密码的4种方法(以windows为例)"></a>三、MySQL修改root密码的4种方法(以windows为例)</h1><ul>
<li><p>方法1：<br>用<code>SET PASSWOR</code>命令 <br>首先登录MySQL。 <br>格式：<code>mysql&gt; set password for 用户名@localhost = password(&#39;新密码&#39;); </code><br>例子：<code>mysql&gt; set password for root@localhost = password(&#39;123&#39;); </code></p>
</li>
<li><p>方法2：用<code>mysqladmin </code><br>格式：<code>mysqladmin -u用户名 -p旧密码 password 新密码 </code><br>例子：<code>mysqladmin -uroot -p123456 password 123 </code></p>
</li>
<li><p>方法3：<br>用<code>UPDATE</code>直接编辑<code>user</code>表 <br>首先登录MySQL。 <br><code>mysql&gt; use mysql; </code><br><code>mysql&gt; update user set password=password(&#39;123&#39;) where user=&#39;root&#39; and host=&#39;localhost&#39;; </code><br><code>mysql&gt; flush privileges;</code></p>
</li>
<li><p>方法4：在忘记root密码的时候，可以这样 <br>以windows为例： </p>
<ul>
<li><ol>
<li>关闭正在运行的MySQL服务。 </li>
</ol>
</li>
<li><ol start="2">
<li>打开DOS窗口，转到mysql\bin目录。 </li>
</ol>
</li>
<li><ol start="3">
<li>输入<code>mysqld --skip-grant-tables</code> 回车。<code>--skip-grant-tables</code> 的意思是启动MySQL服务的时候跳过权限表认证。 </li>
</ol>
</li>
<li><ol start="4">
<li>再开一个DOS窗口（因为刚才那个DOS窗口已经不能动了），转到mysql\bin目录。 </li>
</ol>
</li>
<li><ol start="5">
<li>输入mysql回车，如果成功，将出现MySQL提示符 &gt;。 </li>
</ol>
</li>
<li><ol start="6">
<li>连接权限数据库： <code>use mysql; </code> </li>
</ol>
</li>
<li><ol start="7">
<li>改密码：<code>update user set password=password(&quot;123&quot;) where user=&quot;root&quot;;</code>（别忘了最后加分号） 。 </li>
</ol>
</li>
<li><ol start="8">
<li>刷新权限（必须步骤）：<code>flush privileges;　</code> </li>
</ol>
</li>
<li><ol start="9">
<li>退出 quit。 </li>
</ol>
</li>
<li><ol start="10">
<li>注销系统，再进入，使用用户名root和刚才设置的新密码123登录。</li>
</ol>
</li>
</ul>
</li>
</ul>
<h1 id="四、MySQL典型的三种引擎"><a href="#四、MySQL典型的三种引擎" class="headerlink" title="四、MySQL典型的三种引擎"></a>四、MySQL典型的三种引擎</h1><p><strong>查看所有的数据库引擎</strong><br><code>show engines;</code><br><code>show engines \G; </code>更友好的页面</p>
<ul>
<li><p>MyISAM:<br><code>不支持事务、外键</code>。访问<code>速度快</code>即<code>查询插入快 删除更新慢</code><br>MyISAM的表存储成3个文件。文件的名字与表名相同,拓展名为<code>frm、MYD、MYI</code>。<br>其实，<code>frm</code>文件存储表的结构；<code>MYD</code>文件存储数据，是<code>MYData</code>的缩写；<code>MYI</code>文件存储索引，是<code>MYIndex</code>的缩写。MyISAM的<code>优势</code>在于<code>占用空间小，处理速度快</code>。<code>缺点</code>是<code>不支持事务的完整性和并发性</code>。</p>
</li>
<li><p>INNODB:<br><code>提供了事务，回滚以及系统崩溃修复能力和多版本并发控制的事务的安全。</code><br><code>支持AUTO_INCREMENT</code><br><code>支持外键（FOREIGN KEY）</code><br><code>外键所在的表叫做子表，外键所依赖（REFERENCES）的表叫做父表。</code><br><code>父表中被字表外键关联的字段必须为主键。</code><br><code>当删除、更新父表中的某条信息时，子表也必须有相应的改变，这是数据库的参照完整性规则。</code><br><code>缺点是读写效率较差，占用的数据空间相对较大。</code></p>
</li>
<li><p>MEMORY：<br>它使用存储在<code>内存</code>中的内容来创建表，而且数据全部放在内存中。这些特性与<code>前面的两个</code>很不同。<br>MEMORY默认使用<code>哈希索引</code>。速度比使用<code>B型树索引快</code>。当然如果你想用B型树索引，可以在创建索引时指定。<br><code>MEMORY用到的很少</code>，因为它是把数据存到<code>内存</code>中，如果内存出现异常就会影响数据。<br>如果重启或者关机，所有数据都会消失。因此，基于MEMORY的表的生命周期很短，一般是<code>一次性</code>的。</p>
</li>
</ul>
<p><code>注意</code>，<code>同一个数据库</code>也可以使用<code>多种存储引擎的表</code>。<br>如果一个表要求比较高的<code>事务处理</code>，可以选择<code>InnoDB</code>。<br>这个数据库中可以将<code>查询要求比较高</code>的表选择<code>MyISAM</code>存储。<br>如果该数据库需要一个用于<code>查询的临时表</code>，可以选择<code>MEMORY</code>存储引擎。</p>
<p><strong>查看当前默认引擎</strong><br><code>show variables like &quot;storage_engine%&quot;;</code></p>
<p><code>修改表的引擎</code><br>这种转化方式需要大量的时间 和I/O，mysql要执行从旧表 到新表的一行一行的复制所以效率比较低,在转化这期间源表加了读锁,从一种引擎到另一种引擎做表转化，所有属于原始引擎的专用特性都会丢失，<br>比如从<code>innodb</code>到 <code>myisam</code> 则 <code>innodb</code>的索引会丢失！<br><code>alter  table  tablename  engine = INnodb /MyISAM/Memory</code></p>
<p><code>配置文件修改默认引擎</code><br><strong>my.in</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">default-storage-engine&#x3D;INNODB</span><br></pre></td></tr></table></figure>


<h1 id="五、完整性约束关键字"><a href="#五、完整性约束关键字" class="headerlink" title="五、完整性约束关键字"></a>五、完整性约束关键字</h1><ul>
<li>NOT NULL</li>
<li>DEFAULT</li>
<li>UNIQUE</li>
<li>PRIMARY KEY</li>
<li>AUTO_INCREMENT</li>
<li>FOREIGN KEY</li>
</ul>
<h1 id="六、索引（index-key）"><a href="#六、索引（index-key）" class="headerlink" title="六、索引（index|key）"></a>六、索引（index|key）</h1><p>索引按储存类型分为<code>BTREE索引</code>和<code>HASH索引</code><br>msyql中6种索引：<code>普通索引、唯一索引、全文索引、单列索引、多列索引、空间索引</code>。<br><code>INNODB</code>和<code>MYISAM</code>支持<code>BTREE索引</code>，<code>MEMORY</code>支持<code>HASH|BTREE索引</code>。<br>msyql所支持的存储引擎对每个表至少支持<code>16个索引</code>，总索引长度<code>至少256字节</code>。</p>
<ul>
<li>建表时增加索引</li>
</ul>
<blockquote>
<p>create table table_name(<br>   id int,<br>   name varchar(10),<br>   age tinyint unsigned<br>   INDEX|KEY 【index_name】(字段名 【（长度）】【ASC|DESC】)<br>)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;db1&#96;.&#96;tb3&#96;  (</span><br><span class="line">  &#96;name&#96; varchar(10)  DEFAULT NULL,</span><br><span class="line">  &#96;gg3&#96; char(3) DEFAULT NULL,</span><br><span class="line">  &#96;mmm&#96; varchar(255) DEFAULT NULL,</span><br><span class="line">  &#96;id&#96; int(10) NOT NULL DEFAULT 0,</span><br><span class="line">  &#96;hh&#96; int(11) DEFAULT NULL,</span><br><span class="line">	KEY  (name),</span><br><span class="line">	INDEX ggindex(gg3),</span><br><span class="line">	INDEX hhkey(hh),</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;) USING BTREE</span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>分析(<code>explain</code>)是否用到了索引<br><code>explain select * from table_name where name=&#39;dfad&#39; \G</code></li>
<li>在已存在的表上创建<code>普通索引</code></li>
</ul>
<p>2.<code>create index 索引名 on 表名（字段名【（长度）】 【ASC|DESC】）</code><br>3.<code>alter table table_naem add index|key index_name(属性名 【（长度）】【ASC|DESC】)</code><br><em>example:</em><br><code>create index mmm_index on db3(mmm(10) ASC);</code></p>
<ul>
<li><p>创建<code>唯一索引</code>与创建普通索引基本一致就多了个<code>UNIQUEDROP TABLE IF EXISTS </code>tb4<code>;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;tb4&#96; (</span><br><span class="line">&#96;id&#96; INT ( 10 ),</span><br><span class="line">&#96;name&#96; VARCHAR ( 10 ),</span><br><span class="line">&#96;age&#96; int,</span><br><span class="line">&#96;address&#96; VARCHAR ( 11 ) DEFAULT NULL,</span><br><span class="line">UNIQUE INDEX|KEY ( &#96;id&#96; ) USING BTREE </span><br><span class="line">) ENGINE &#x3D; INNODB;</span><br></pre></td></tr></table></figure>
<p><code>CREATE UNIQUE INDEX hh_index ON tb4(</code>address<code>);</code><br><code>ALTER TABLE tb4 ADD UNIQUE INDEX|KEY name_index(</code>name<code> ASC);</code></p>
</li>
<li><p><code>全文索引</code>MySQL<code> 5.6</code> 以前的版本，只有 MyISAM 存储引擎支持全文索引；<br>MySQL <code>5.6 及以后</code>的版本，MyISAM 和 <code>InnoDB（创建时，非常耗时） </code>存储引擎<code>均支持</code>全文索引;<br>只有字段的数据类型为<code> char、varchar、text 及其系列</code>才可以建全文索引。</p>
</li>
<li><p>创建全文索引<code>DROP TABLE IF EXISTS </code>tb4<code>;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;tb4&#96; (</span><br><span class="line">&#96;id&#96; INT ( 10 ),</span><br><span class="line">&#96;name&#96; VARCHAR ( 10 ),</span><br><span class="line">&#96;name2&#96; VARCHAR ( 10 ),</span><br><span class="line">&#96;name3&#96; VARCHAR ( 10 ),</span><br><span class="line">&#96;age&#96; int,</span><br><span class="line">&#96;address&#96; VARCHAR ( 11 ) DEFAULT NULL,</span><br><span class="line">FULLTEXT INDEX ( &#96;name&#96; ) </span><br><span class="line">) ENGINE &#x3D; MYISAM;</span><br></pre></td></tr></table></figure>
<p><code>CREATE FULLTEXT INDEX name2_index ON tb4(</code>name2<code>);</code><br><code>ALTER TABLE tb4 ADD FULLTEXT INDEX name3_index(</code>name3<code> ASC);</code></p>
</li>
<li><p>删除索引<br><code>drop index index_name on table_name ;</code><br><code>alter table table_name drop index index_name ;</code><br><code>alter table table_name drop primary key ;</code></p>
</li>
</ul>
<p>其中，在前面的两条语句中，都删除了table_name中的索引index_name。而在最后一条语句中，只在删除PRIMARY KEY索引中使用，因为<code>一个表只可能有一个PRIMARY KEY索引</code>，因此不需要指定索引名。如果没有创建PRIMARY KEY索引，但表具<code>有一个或多个UNIQUE索引</code>，则MySQL将删除<code>第一个UNIQUE索引</code>。</p>
<h1 id="七、视图（view）"><a href="#七、视图（view）" class="headerlink" title="七、视图（view）"></a>七、视图（view）</h1><p><code>视图的建立和删除</code>不影响基本表。当时图来自一个表时，对<code>视图的更新（添加删除和修改）</code>直接影响基本表。当时图来自<code>多个基本表时</code>，<code>不允许</code>添加和删除数据。</p>
<ul>
<li>创建视图<br><code>CREATE VIEW 视图名(列1，列2...) AS SELECT 列1，列2... FROM ...;</code><br><code>使用视图当成表使用就好</code></li>
<li>修改视图<br><code>CREATE OR REPLACE VIEW 视图名 AS SELECT [...] FROM [...];</code><br><code>alter view view_name as 查询字句；</code></li>
<li>删除视图<br><code>drop view view_nama;</code></li>
<li>查看数据库已有视图<br><code>SHOW TABLES [like...];（可以使用模糊查找）</code><br><code>show table status 【from dbname】 【like &#39;pattern&#39;】；</code><br><code>show create view view_name;</code></li>
<li>查看视图详情<br><code>DESC 视图名或者SHOW FIELDS FROM 视图名 视图条件限制    [WITH CHECK OPTION]</code></li>
<li>查看视图数据<br><code>select * from view_name;insert into view_name (字段，字段) values(真实值，真实值);（只对单表示图有效）</code><br><code>update view_name set 字段=&quot;&quot; where 字段=&quot;&quot;;delete from view_name where 字段=“”；</code></li>
</ul>
<h1 id="八、-触发器（trigger）"><a href="#八、-触发器（trigger）" class="headerlink" title="八、 触发器（trigger）"></a>八、 触发器（trigger）</h1><ul>
<li>mysql在执行insert、update、delete语句时会触发触发器。</li>
<li>创建触发器语法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create trigger trigger_name before|after trigger_event on table_name for each row trigger_stmt;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>CREATE<br>    [DEFINER = { user | CURRENT_USER }]<br>    TRIGGER trigger_name<br>    trigger_time trigger_event<br>    ON tbl_name FOR EACH ROW<br>    trigger_body<br>trigger_time: { BEFORE | AFTER }<br>trigger_event: { INSERT | UPDATE | DELETE }<br>trigger_body:sql语句</p>
</blockquote>
<p><em>example:</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER trigger_insert_stu</span><br><span class="line">BEFORE INSERT</span><br><span class="line">ON tb_stu FOR EACH ROW</span><br><span class="line">INSERT INTO t_log(id,table_name,event,time) VALUES(&quot;&quot;,&quot;t_stu&quot;,&quot;INSERT&quot;,NOW());</span><br></pre></td></tr></table></figure>
<ul>
<li>创建多条执行语句的触发器语法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE</span><br><span class="line">    TRIGGER trigger_name</span><br><span class="line">    trigger_time trigger_event</span><br><span class="line">    ON tbl_name FOR EACH ROW      </span><br><span class="line">BEGIN</span><br><span class="line">      trigger_body      </span><br><span class="line">END</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><em>example:</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">DROP TRIGGER IF EXISTS trigger_insert_stu;</span><br><span class="line">CREATE TRIGGER trigger_insert_stu</span><br><span class="line">BEFORE INSERT</span><br><span class="line">ON tb_stu FOR EACH ROW</span><br><span class="line">BEGIN</span><br><span class="line">INSERT INTO tb_log(id,table_name,event,time) VALUES(&quot;&quot;,&quot;t_stu&quot;,&quot;INSERT&quot;,NOW());</span><br><span class="line">INSERT INTO tb_log(id,table_name,event,time) VALUES(&quot;&quot;,&quot;t_stu2&quot;,&quot;INSERT2&quot;,NOW());</span><br><span class="line">END</span><br><span class="line">$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
<ul>
<li>查看触发器<br><code>show triggers;</code></li>
<li>切换系统表查看<br><code>use information_schemadesc triggers;</code><br><code>select * from triggers \G</code></li>
<li>删除触发器<br><code>drop trigger trigger_name;</code></li>
</ul>
<h1 id="九、存储过程（procedure-和函数-function"><a href="#九、存储过程（procedure-和函数-function" class="headerlink" title="九、存储过程（procedure)和函数(function)"></a>九、存储过程（procedure)和函数(function)</h1><blockquote>
<p>CREATE<br>    [DEFINER = { user | CURRENT_USER }]<br>    PROCEDURE sp_name ([proc_parameter[,…]])<br>    [characteristic …] routine_body<br>CREATE<br>    [DEFINER = { user | CURRENT_USER }]<br>    FUNCTION sp_name ([func_parameter[,…]])<br>    RETURNS type<br>    [characteristic …] routine_body<br>proc_parameter:<br>    [ IN | OUT | INOUT ] param_name type<br>func_parameter:<br>    param_name type<br>type:<br>    Any valid MySQL data type<br>characteristic:<br>    COMMENT ‘string’<br>  | LANGUAGE SQL<br>  | [NOT] DETERMINISTIC<br>  | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }<br>  | SQL SECURITY { DEFINER | INVOKER }<br>routine_body:<br>    Valid SQL routine statement</p>
</blockquote>
<ul>
<li><p>创建存储过程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">CREATE PROCEDURE proce_employee_sal()</span><br><span class="line">COMMENT &#39;查询所有雇员工资&#39;</span><br><span class="line">BEGIN</span><br><span class="line">    SELECT sal FROM t_employee;</span><br><span class="line">END$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure></li>
<li><p>创建函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">delimiter $$</span><br><span class="line">CREATE FUNCTION func_employee_sal(empno INT(11))</span><br><span class="line">RETURNS DOUBLE(10,2)</span><br><span class="line">COMMENT &#39;查询某个雇员工资&#39;</span><br><span class="line">BEGIN</span><br><span class="line">   RETURN (SELECT sal FROM t_temployee </span><br><span class="line">	 WHERE t_employee.empno&#x3D;empno);</span><br><span class="line">END$$</span><br><span class="line">delimiter ;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改存储过程</p>
</li>
</ul>
<blockquote>
<p>alter procedure procedure_name  [characteristic …] characteristic:   | {<br> CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }<br>   | SQL SECURITY { DEFINER | INVOKER }   |comment ‘string’</p>
</blockquote>
<ul>
<li><p>修改函数</p>
<blockquote>
<p>alter function function_name  [characteristic …] characteristic:   | { CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA }<br> | SQL SECURITY { DEFINER | INVOKER }   |comment ‘string’</p>
</blockquote>
</li>
<li><p>删除存储过程和函数<br><code>drop procedure procedure_name;</code><br><code>drop function function_name;</code></p>
</li>
</ul>
<p><strong><em>存储过程与函数有待补充</em></strong></p>
<h1 id="十、mysql事务"><a href="#十、mysql事务" class="headerlink" title="十、mysql事务"></a>十、mysql事务</h1><ul>
<li>1.原子性（atomicity）<br>事务中所涉及的程序对数据库的修改操作要么全部成功，要么全部失败。</li>
<li>2.一致性(consistency)<br>事务执行前和执行后来源和去向保持平衡。</li>
<li>3.隔离型(isolation)<br>并发时每个事务是隔离的，相互不影响。</li>
<li>4.持久性(durability)<br>一旦事务成功提交，应该保证数据的完整存在。</li>
</ul>
<p><code>show session variables like &#39;autocommit&#39;;</code><br><code>set @@autocommit = 0;</code><br><code>show session variables like &#39;autocommit&#39;;</code></p>
<p><strong>mysql通过以下语句支持事务</strong></p>
<ul>
<li>1、 事务开始<br><code>begin或start transaction;</code></li>
<li>2、 事务提交<br><code>commit或commit work；</code></li>
<li>3、 回滚<br><code>rollback或rollback work；</code></li>
<li>4、 保存点设置<br><code>savepoint 标识；</code></li>
<li>5、 回滚到保存点<br><code>rollback to savepoint 标识；</code></li>
<li>6、 删除保存点<br><code>release savepoint 标识；</code></li>
</ul>
<p><strong>事务隔离级别</strong></p>
<ul>
<li><p>READ-UNCOMMITTED  读未提交<br>所有事务都可以看到没有提交事务的数据。另一个事务修改了数据，但尚未提交，而本事务中的SELECT会读到这些未被提交的数据（脏读）。</p>
</li>
<li><p>READ-COMMITTED    读已提交（Oracle，SQL Server默认）<br>事务成功提交后才可以被查询到。本事务读取到的是最新的数据（其他事务提交后的）。问题是，在同一个事务里，前后两次相同的SELECT会读到不同的结果（不重复读）。在同一个事务生命周期内，也就是这个事务还未提交之前。如果另外一个事务，对数据进行了编辑(update)或者删除(delete)操作。那么A事务就会读取到。简单理解，就是在一个事务生命周期内，多次查询数据，每次都可能查出来的不一样。</p>
</li>
<li><p>REPEATABLE-READ   重复读(mysql默认级别)<br>同一个事务多个实例读取数据时，可能将未提交的记录查询出来，而出现幻读。即同一个事务里，SELECT的结果是事务开始时时间点的状态，因此，同样的SELECT操作读到的结果会是一致的。但是，会有幻读现象。幻读的结果其实和不可重复读是一样的表现，差异就在于，不可重复读，主要是针对其他事务进行了编辑(update)和删除(delete)操作。而幻读主要是针对插入(insert)操作。也就是在一个事务生命周期内，会查询到另外一个事务新插入的数据。</p>
</li>
<li><p>SERIALIZABLE     序列化<br>读操作会隐式获取共享锁，可以保证不同事务间的互斥。强制的进行排序，在每个读读数据行上添加共享锁。会导致大量超时现象和锁竞争。</p>
</li>
</ul>
<p><strong>四个级别逐渐增强，每个级别解决一个问题。</strong></p>
<ul>
<li>脏读<br>最容易理解。另一个事务修改了数据，但尚未提交，而本事务中的SELECT会读到这些未被提交的数据。</li>
<li>不重复读<br>解决了脏读后，会遇到，同一个事务执行过程中，另外一个事务提交了新数据，因此本事务先后两次读到的数据结果会不一致。</li>
<li>幻读<br>解决了不重复读，保证了同一个事务里，查询的结果都是事务开始并且第一次查询时的状态（一致性）。但是，如果另一个事务同时提交了新数据，虽然本事务再次按照相同的条件查找会得到相同的结果集，但是本事务指定更新时(看了后面的演示你就会知道)，就会“惊奇的”发现了这些新数据，貌似之前读到的数据是“鬼影”一样的幻觉。</li>
</ul>
<p>不同的隔离级别有不同的现象，并有不同的锁定/并发机制，隔离<code>级别越高</code>，数据库的<code>并发性就越差</code>，4种事务隔离级别分别表现的现象如下表：</p>
<table>
<thead>
<tr>
<th align="center">隔离级别</th>
<th align="center">脏读</th>
<th align="center">不重复读</th>
<th align="center">幻读</th>
</tr>
</thead>
<tbody><tr>
<td align="center">read uncommitted</td>
<td align="center">YES</td>
<td align="center">YES</td>
<td align="center">YES</td>
</tr>
<tr>
<td align="center">read committed</td>
<td align="center">NO</td>
<td align="center">YES</td>
<td align="center">YES</td>
</tr>
<tr>
<td align="center">repeatable read</td>
<td align="center">NO</td>
<td align="center">NO</td>
<td align="center">YES</td>
</tr>
<tr>
<td align="center">serializable</td>
<td align="center">NO</td>
<td align="center">NO</td>
<td align="center">NO</td>
</tr>
<tr>
<td align="center">参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/fsfsfsdfsdfdr/article/details/82984114">MySQL InnoDB事务的隔离级别</a></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p><strong>查看隔离级别</strong></p>
<ul>
<li><p>1.查看当前会话隔离级别<br><code>select @@tx_isolation;</code></p>
</li>
<li><p>2.查看系统当前隔离级别<br><code>select @@global.tx_isolation;</code></p>
</li>
<li><p>3.设置当前会话隔离级别<br><code>set session transaction isolatin level repeatable read;</code></p>
</li>
<li><p>4.设置系统当前隔离级别<br><code>set global transaction isolation level repeatable read;</code></p>
</li>
</ul>
<blockquote>
<p>SET [GLOBAL | SESSION] TRANSACTION ISOLATION LEVEL<br>       READ UNCOMMITTED<br>     | READ COMMITTED<br>     | REPEATABLE READ<br>     | SERIALIZABLE；</p>
</blockquote>
<p>#十一、传播行为</p>
<ul>
<li>PROPAGATION_REQUIRED：如果当前没有事务，就创建一个新事务，如果当前存在事务，就加入该事务，该设置是最常用的设置。</li>
<li>PROPAGATION_SUPPORTS：支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就以非事务执行。‘</li>
<li>PROPAGATION_MANDATORY：支持当前事务，如果当前存在事务，就加入该事务，如果当前不存在事务，就抛出异常。</li>
<li>PROPAGATION_REQUIRES_NEW：创建新事务，无论当前存不存在事务，都创建新事务。</li>
<li>PROPAGATION_NOT_SUPPORTED：以非事务方式执行操作，如果当前存在事务，就把当前事务挂起。</li>
<li>PROPAGATION_NEVER：以非事务方式执行，如果当前存在事务，则抛出异常。</li>
<li>PROPAGATION_NESTED：如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则执行与PROPAGATION_REQUIRED类似的操作。</li>
</ul>
<p><strong><code>1.PROPAGATION_REQUIRED</code></strong></p>
<blockquote>
<p>加入当前正要执行的事务不在另外一个事务里，那么就起一个新的事务<br>比如说，ServiceB.methodB的事务级别定义为PROPAGATION_REQUIRED, 那么由于执行ServiceA.methodA的时候，<br>ServiceA.methodA已经起了事务，这时调用ServiceB.methodB，ServiceB.methodB看到自己已经运行在ServiceA.methodA<br>的事务内部，就不再起新的事务。而假如ServiceA.methodA运行的时候发现自己没有在事务中，他就会为自己分配一个事务。<br>这样，在ServiceA.methodA或者在ServiceB.methodB内的任何地方出现异常，事务都会被回滚。即使ServiceB.methodB的事务已经被<br>提交，但是ServiceA.methodA在接下来fail要回滚，ServiceB.methodB也要回滚</p>
</blockquote>
<p><strong><code> 2.PROPAGATION_SUPPORTS</code></strong></p>
<blockquote>
<p>如果当前在事务中，即以事务的形式运行，如果当前不再一个事务中，那么就以非事务的形式运行</p>
</blockquote>
<p><strong><code>3.PROPAGATION_MANDATORY</code></strong></p>
<blockquote>
<p>必须在一个事务中运行。也就是说，他只能被一个父事务调用。否则，他就要抛出异常</p>
</blockquote>
<p><strong><code>4.PROPAGATION_REQUIRES_NEW</code></strong> </p>
<blockquote>
<p>这个就比较绕口了。 比如我们设计ServiceA.methodA的事务级别为PROPAGATION_REQUIRED，ServiceB.methodB的事务级别为PROPAGATION_REQUIRES_NEW，<br>那么当执行到ServiceB.methodB的时候，ServiceA.methodA所在的事务就会挂起，ServiceB.methodB会起一个新的事务，等待ServiceB.methodB的事务完成以后，<br>他才继续执行。他与PROPAGATION_REQUIRED 的事务区别在于事务的回滚程度了。因为ServiceB.methodB是新起一个事务，那么就是存在<br>两个不同的事务。如果ServiceB.methodB已经提交，那么ServiceA.methodA失败回滚，ServiceB.methodB是不会回滚的。如果ServiceB.methodB失败回滚，<br>如果他抛出的异常被ServiceA.methodA捕获，ServiceA.methodA事务仍然可能提交。</p>
</blockquote>
<p><strong><code>5.PROPAGATION_NOT_SUPPORTED</code></strong></p>
<blockquote>
<p>当前不支持事务。比如ServiceA.methodA的事务级别是PROPAGATION_REQUIRED ，而ServiceB.methodB的事务级别是PROPAGATION_NOT_SUPPORTED ，<br>那么当执行到ServiceB.methodB时，ServiceA.methodA的事务挂起，而他以非事务的状态运行完，再继续ServiceA.methodA的事务。</p>
</blockquote>
<p><strong><code> 6.PROPAGATION_NEVER</code></strong></p>
<blockquote>
<p>不能在事务中运行。假设ServiceA.methodA的事务级别是PROPAGATION_REQUIRED， 而ServiceB.methodB的事务级别是PROPAGATION_NEVER ，那么ServiceB.methodB就要抛出异常了。</p>
</blockquote>
<p><strong><code>7.PROPAGATION_NESTED</code></strong></p>
<blockquote>
<p>理解Nested的关键是savepoint。他与PROPAGATION_REQUIRES_NEW的区别是，PROPAGATION_REQUIRES_NEW另起一个事务，将会与他的父事务相互独立，而Nested的事务和他的父事务是相依的，他的提交是要等和他的父事务一块提交的。也就是说，如果父事务最后回滚，他也要回滚的。<br>而Nested事务的好处是他有一个savepoint。</p>
</blockquote>
<p>来自 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/523823-wu/p/8874328.html">数据库事务4种隔离级别和7种传播行为</a></p>
<h1 id="十二-、其它"><a href="#十二-、其它" class="headerlink" title="十二 、其它"></a>十二 、其它</h1><ul>
<li><p>查看帮助<br><code>help contents;</code></p>
</li>
<li><p>查看数据类型<br><code>help data types;</code></p>
</li>
<li><p>查看int类型<br><code>help int;</code></p>
</li>
<li><p>查看某个数据库某张表的相关信息(有可能第三方客户端查看不了，黑窗口命令行可以)<br><code>show table status from database_name where name=&quot;table_name&quot; \G;</code></p>
</li>
<li><p>查看表结构<br><code>show create table  table_name; </code></p>
</li>
</ul>
<p><strong>创建数据库</strong></p>
<blockquote>
<p>create database database_name;</p>
</blockquote>
<p><code>create database db1;(创建一个名为db1的数据库)</code></p>
<ul>
<li><p>展示所有数据库<br><code>show databases;</code></p>
</li>
<li><p>查看数据库版本<br><code>select version();</code></p>
</li>
<li><p>使用某个数据库<br><code>use db1;</code></p>
</li>
<li><p>删除数据库</p>
<blockquote>
<p>drop database database_name;</p>
</blockquote>
</li>
<li><p>查看表结构</p>
<blockquote>
<p>show create table  table_name;</p>
</blockquote>
</li>
</ul>
<p><strong>创建表</strong></p>
<blockquote>
<p>create table table_name(<br>属性名 数据类型,<br>属性名 数据类型,<br>……<br>)</p>
</blockquote>
<p><strong>查看表结构</strong></p>
<blockquote>
<p>DESC table_name;<br>describe table_name;<br>show create table table_name;</p>
</blockquote>
<p><strong>删除表</strong></p>
<blockquote>
<p>drop table table_name;</p>
</blockquote>
<p><strong>修改表名</strong></p>
<blockquote>
<p>alter table old_table_name rename [to] new_table_name;</p>
</blockquote>
<p><strong>增加字段</strong></p>
<blockquote>
<p>alter table table_name add 属性名 属性类型；<br>alter table table_name add 属性名 属性类型 first；(字段位置为第一)<br>alter table table_name add 属性名 属性类型 after 字段名；（在某子断后增加一个字段）</p>
</blockquote>
<p><strong>删除字段</strong></p>
<blockquote>
<p>alter table table_name drop 字段名；</p>
</blockquote>
<p><strong>修改字段数据</strong></p>
<blockquote>
<p>alter table table_name modify 字段名 字段类型；</p>
</blockquote>
<p><strong>修改字段名字</strong></p>
<blockquote>
<p>alter table table_name change 旧字段名 新字段名 旧数据类型；</p>
</blockquote>
<p><strong>同时修改字段名字和数据类型</strong></p>
<blockquote>
<p>alter table table_name change 旧字段名 新字段名 新数据类型；</p>
</blockquote>
<p><strong>修改字段顺序</strong></p>
<blockquote>
<p>alter table table_name modify 字段1 数据类型 first|after 字段2；</p>
</blockquote>
<p><strong>插入数据</strong></p>
<blockquote>
<p>insert into table_name[(fiele1,field2….)]values(“”,””,…..),(“”,””,….);</p>
</blockquote>
<p><strong>更新数据</strong></p>
<blockquote>
<p>update table_name set field1=value1,field2=value2,…. [where condition];</p>
</blockquote>
<p><strong>删除数据</strong></p>
<blockquote>
<p>delete from table_name [where condition];</p>
</blockquote>
<p><strong>单表查询</strong></p>
<blockquote>
<p>select * from table_name;(查询所有数据)<br>select fiele1,field2…. from table_name;</p>
</blockquote>
<p><strong>去除重复数据</strong>（distinct）</p>
<blockquote>
<p>select distinct fiele form table_name;</p>
</blockquote>
<p><strong>实现数学四则运算查询</strong></p>
<blockquote>
<p>select field1 [as] otherfield1,field2 [as] otherfield2….from table_name;</p>
</blockquote>
<p><strong>concat()合并字符串和数值</strong></p>
<blockquote>
<p>select concat(field1,field2…) [as] field from table_name;</p>
</blockquote>
<p><strong>条件数据查询</strong></p>
<blockquote>
<p>select * from table_name where conditioncondition:</p>
</blockquote>
<ul>
<li>1.关系运算符(&gt;,&lt;,=,&gt;=,&lt;=,&lt;&gt;|!=)，逻辑运算符(and(&amp;&amp;),or(||),xor(异或)，not(!))</li>
<li>2.带between and (在之间，是范围)关键字的条件查询</li>
<li>3.is null   is not null</li>
<li>4.in（在之内，是集合）   where name in(“abc”,null)(只查询name是abc的，name为null的不查询)   where name  not in(“abc”,null) 查不到数据</li>
<li>5.like   not like   “-“匹配单个字符  “%”匹配任意个字符</li>
</ul>
<p><strong>排序查询(order by )</strong></p>
<blockquote>
<p>select field1,field2… from table_name where condition order by field1 [ASC|DESC],field2 [ASC|DESC],</p>
</blockquote>
<p><strong>分页查询</strong></p>
<blockquote>
<p>select * from  table_name where condition limit [offset_start ,]row_count;<br>offset_start:起始偏移量，起始位置默认为0.<br>row_count：查询行数</p>
</blockquote>
<p><strong>统计函数</strong></p>
<ul>
<li>count():统计总记录数</li>
<li>avg():平均值</li>
<li>sum():求和</li>
<li>max():最大值</li>
<li>min():最小值</li>
</ul>
<p><strong>分组查询</strong><br><code>group by having</code><br><strong>全部查询结构</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT #去重 id,</span><br><span class="line">NAME </span><br><span class="line">FROM</span><br><span class="line">	tb_stu </span><br><span class="line">WHERE</span><br><span class="line">	NAME &#x3D; &quot;gg&quot; </span><br><span class="line">GROUP BY #分组 tb_stu.NAME </span><br><span class="line">HAVING</span><br><span class="line">	id &gt; 5 </span><br><span class="line">ORDER BY #排序 tb_stu.NAME ASC </span><br><span class="line">	LIMIT 0,5 #分页</span><br></pre></td></tr></table></figure>


<p><strong>连接查询与子查询比较</strong></p>
<ul>
<li>连接查询效率高，但是会导致重复数据。如果确定连接查询不会重复，那么用连接查询会比较好。</li>
<li>子查询效率低，但是可以避免重复数据。如果要到子查询，尽量使用索引提高效率。有些情况必须避免重复数据，那就只能用子查询。</li>
<li>但是具体问题还是要具体分析。如果主表很小，子表很大，并且有索引，是可以使用子查询的，如果主表很大，那就尽量避免子查询了。<br>;</li>
</ul>
<p><strong>内连接inner join on</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from a_table a inner join b_table b on a.a_id &#x3D; b.b_id;</span><br><span class="line">相同</span><br><span class="line">SELECT * FROM a_table a,b_table b WHERE a.a_id &#x3D; b.b_id;</span><br></pre></td></tr></table></figure>
<p><strong>外连接左外连接</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from a_table a left join b_table b on a.a_id &#x3D; b.b_id;</span><br></pre></td></tr></table></figure>
<p><code>left join </code>是  <code>left outer join</code>的简写，它的全称是<code>左外连接</code>，是外连接中的一种。左(外)连接，<code>左表</code>(a_table)的记录将会全部表示出来，而<code>右表</code>(b_table)只会显示<code>符合</code>搜索条件的记录。<code>右表</code>记录不足的地方均为<code>NULL</code>。</p>
<p><strong>右外连接</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from a_table a right outer join b_table b on a.a_id &#x3D; b.b_id;</span><br></pre></td></tr></table></figure>
<p><code>right join</code>是<code>right outer join</code>的简写，它的全称是<code>右外连接</code>，是外连接中的一种。<br>与左(外)连接相反，右(外)连接，<code>左表</code>(a_table)只会显示符合搜索条件的记录，而<code>右表</code>(b_table)的记录将会<code>全部</code>表示出来。<code>左表</code>记录不足的地方均为<code>NULL</code>。</p>
<p><strong>合并查询（union）(查询字段要相同)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT id,name,age FROM tb_stu UNION SELECT id,name,age FROM tb_stu2;</span><br><span class="line">#（去重，三个字段的直都相同，才是重复数据）</span><br><span class="line">SELECT id,name,age FROM tb_stu UNION ALL SELECT id,name,age FROM tb_stu2;</span><br><span class="line">#（不去重）</span><br></pre></td></tr></table></figure>

<p><strong>子查询where型子查询</strong></p>
<p>查出每个栏目最新的商品(以good_id为最大为最新商品)：<br>goods货物表，good_id表的主键,cat_id栏目的编号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select cat_id,good_id,good_name from goods where good_id in(selct max(good_id) from goods group by cat_id);</span><br></pre></td></tr></table></figure>
<p><strong>form型子查询</strong><br>查出每个栏目最新的商品(以good_id为最大为最新商品)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from (select cat_id,good_id,good_name from goods order by cat_id asc, good_id desc) as tep group by cat_id;</span><br></pre></td></tr></table></figure>
<p><strong>in子查询</strong><br>查询年龄为20岁的员工部门</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from department where did in(SELECT did from employee where age&#x3D;20);</span><br></pre></td></tr></table></figure>
<p><strong>exists子查询</strong><br>查询是否存在年龄大于21岁的员工</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from department where EXISTS (SELECT did from employee where age&gt;21);</span><br></pre></td></tr></table></figure>
<p><strong>any子查询</strong><br>查询满足条件的部门</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from department where did&gt; any (SELECT did from employee );</span><br></pre></td></tr></table></figure>
<p><strong>all子查询</strong><br>查询满足条件的部门</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from department where did&gt; all(SELECT did from employee );</span><br></pre></td></tr></table></figure>
<p><strong><code>总结： </code></strong></p>
<ul>
<li>where型子查询：指把内部查询的结果作为外层查询的比较条件。 </li>
<li>from型子查询：把内层的查询结果当成临时表，供外层sql再次查询。 </li>
<li>in子查询：内层查询语句仅返回一个数据列，这个数据列的值将供外层查询语句进行比较。 </li>
<li>exists子查询：把外层的查询结果，拿到内层，看内层是否成立，简单来说后面的返回true,外层（也就是前面的语句）才会执行，否则不执行。 </li>
<li>any子查询：只要满足内层子查询中的任意一个比较条件，就返回一个结果作为外层查询条件。 </li>
<li>all子查询：内层子查询返回的结果需同时满足所有内层查询条件。<br>比较运算符子查询：子查询中可以使用的比较运算符如 “&gt;” “&lt;” “= ” “!=”</li>
</ul>
<p>bye!  (*_*)</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-mysql/MySQL相关的一些配置及操作"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/15/mysql/MySQL%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE%E5%8F%8A%E6%93%8D%E4%BD%9C/"
    >MySQL相关的一些配置及操作</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/15/mysql/MySQL%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%80%E4%BA%9B%E9%85%8D%E7%BD%AE%E5%8F%8A%E6%93%8D%E4%BD%9C/" class="article-date">
  <time datetime="2020-07-15T14:36:00.000Z" itemprop="datePublished">2020-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="一-常用配置解释"><a href="#一-常用配置解释" class="headerlink" title="一 .常用配置解释"></a>一 .常用配置解释</h1><p>##基本配置：</p>
<ul>
<li><p>datadir：指定mysql的数据目录位置，用于存放mysql数据库文件、日志文件等。<br>配置示例：datadir=D:/wamp/mysqldata/Data</p>
</li>
<li><p>default-character-set：mysql服务器默认字符集设置。<br>配置示例：default-character-set=utf8</p>
</li>
<li><p>skip-grant-tables：当忘记mysql用户密码的时候，可以在mysql配置文件中配置该参数，跳过权限表验证，不需要密码即可登录mysql。</p>
</li>
</ul>
<p>##日志相关：</p>
<ul>
<li><p>log-error：指定错误日志文件名称，用于记录当mysqld启动和停止时，以及服务器在运行过程中发生任何严重错误时的相关信息。<br>配置示例：log-error=”WJT-PC.err”（默认在mysql数据目录下）</p>
</li>
<li><p>log-bin：指定二进制日志文件名称，用于记录对数据造成更改的所有查询语句。<br>配置示例：log-bin=”WJT-PC-bin.log”（默认在mysql数据目录下）</p>
</li>
<li><p>binlog-do-db：指定将更新记录到二进制日志的数据库，其他所有没有显式指定的数据库更新将被忽略，不记录在日志中。<br>配置示例：binlog-do-db=db_name</p>
</li>
<li><p>binlog-ignore-db：指定不将更新记录到二进制日志的数据库，其他没有显式忽略的数据库都将进行记录。<br>配置示例：binlog-ignore-db=db_name如果想记录或忽略多个数据库，可以对上面两个选项分别使用多次。</p>
</li>
<li><p>sync-binlog：指定多少次写日志后同步磁盘。<br>配置示例：sync-binlog=N</p>
</li>
<li><p>general-log：是否开启查询日志记录。<br>配置示例：general-log=1</p>
</li>
<li><p>general_log_file：指定查询日志文件名，用于记录所有的查询语句。<br>配置示例：general_log_file=”WJT-PC.log”（默认在mysql数据目录下）</p>
</li>
<li><p>slow-query-log：是否开启慢查询日志记录。<br>配置示例：slow-query-log=1</p>
</li>
<li><p>slow_query_log_file：指定慢查询日志文件名称，用于记录消耗时间较长的查询语句。<br>配置示例：slow_query_log_file=”WJT-PC-slow.log”（默认在mysql数据目录下）</p>
</li>
<li><p>long_query_time：设置慢查询的时间，超过这个时间的查询语句才记录日志。<br>配置示例：long_query_time=10（单位：秒）</p>
</li>
<li><p>log-slow-admin-statements：是否将慢管理语句（例如OPTIMIZE TABLE、ANALYZE TABLE和ALTER TABLE）写入慢查询日志。</p>
<p>##存储引擎相关：</p>
</li>
<li><p>default-table-type：设置mysql的默认存储引擎。</p>
</li>
<li><p>innodb_data_home_dir：InnoDB引擎的共享表空间数据文件根目录。若没有设置，则使用mysql的datadir目录作为缺省目录。</p>
</li>
<li><p>innodb_data_file_path：单独指定共享表空间数据文件的路径与大小。数据文件的完整路径由innodb_data_home_dir与这里配置的值组合起来，文件大小以MB单位指定。<br>配置示例：innodb_data_home_dir=innodb_data_file_path=ibdata1:12M;/data/mysql/mysql3306/data1/ibdata2:12M:autoextend<br>如果想为innodb表空间指定不同目录下的文件，必须指定 innodb_data_home_dir =。这个例子中会在datadir下建立ibdata1，在/data/MySQL/mysql3306/data1/目录下创建ibdata2。</p>
</li>
<li><p>innodb_file_per_table：是否开启独立表空间，若开启，InnoDB将使用独立的.idb文件创建新表而不是在共享表空间中创建。<br>配置示例：innodb_file_per_table=1</p>
</li>
<li><p>innodb_autoinc_lock_mode：配置在向有着auto_increment列的表插入数据时，相关锁的行为。该参数有3个取值：</p>
<ul>
<li><p>0：tradition传统，所有的insert语 句开始的时候得到一个表级的auto_inc锁，在语句结束的时候才能释放 这个锁，影响了并发的插入。</p>
<ul>
<li><p>1：consecutive连续，mysql可以一次生成 几个连续的auto_inc的值，auto_inc不需要一直保持到语句结束，只要 语句得到了相应的值后就可以提前释放锁（这也是mysql的默认模式）。</p>
</li>
<li><p>2：interleaved交错，这个模式下已经没有了auto_inc锁，所以性能是最好的，但是对于同一个语句来说它得到的auto_inc的值可能不是连续的。</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>配置示例：innodb_autoinc_lock_mode=1</p>
<ul>
<li><p>low_priority_updates：在myisam引擎锁使用中，默认情况下写请求优先于读请求，可以通过将该参数设置为1来使myisam引擎给予读请求优先权限， 所有的insert、update、delete和lock table write语句将等待直到受影响的表没有挂起的select或lock table read。<br>配置示例：low_priority_updates=0（默认配置）</p>
</li>
<li><p>max_write_lock_count：当一个myisam表的写锁定达到这个值后，mysql就暂时 将写请求优先级降低，给部分读请求获得锁的机会。</p>
</li>
<li><p>innodb_lock_wait_timeout：InnoDB锁等待超时参数，若事务在该时间内没有获 得需要的锁，则发生回滚。<br>配置示例：innodb_lock_wait_timeout=50（默认50秒）</p>
</li>
<li><p>max_heap_table_size：设置memory表的最大空间大小，该变量可以用来计算 memory表的max_rows值。在已有memory表上设置该参数是没有效果 的，除非重建表。</p>
</li>
</ul>
<p>##查询相关：</p>
<ul>
<li><p>max_sort_length：配置对blob或text类型的列进行排序时使用的字节数（只对配置的前max_sort_length个字节进行排序，其他的被忽略）</p>
</li>
<li><p>max_length_for_sort：mysql有两种排序算法，两次传输排序和单次传输排序。当查询需要所有列的总长度不超过max_length_for_sort时，mysql使用 单次传输排序，否则使用两次传输排序。</p>
</li>
<li><p>optimizer_search_depth：在关联查询中，当需要关联的表数量超过optimizer_search_depth的时候，优化器会使用“贪婪”搜索的方式查找“最优”的关联顺序。</p>
</li>
</ul>
<h1 id="二-连接数-状态"><a href="#二-连接数-状态" class="headerlink" title="二. 连接数,状态"></a>二. 连接数,状态</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;查询前100条数据（info字段中也只会保存100字符）</span><br><span class="line">SHOW PROCESSLIST;  </span><br><span class="line">&#x2F;&#x2F;查询全部的详细信息</span><br><span class="line">SHOW FULL PROCESSLIST;  </span><br><span class="line">&#x2F;&#x2F;查询数据库最大连接数</span><br><span class="line">SHOW VARIABLES LIKE &#39;%max_connections%&#39;;  </span><br><span class="line"></span><br><span class="line">SHOW STATUS LIKE &#39;%Connection%&#39;; </span><br></pre></td></tr></table></figure>

<p>##show processlist;<br>show processlist 是显示用户正在运行的线程，除了 root 用户能看到所有正在运行的线程外，其他用户都只能看到自己正在运行的线程，看不到其它用户正在运行的线程。除非单独个这个用户赋予了PROCESS 权限。</p>
<ul>
<li>root用户，可以看到全部线程运行情况</li>
<li>普通的activiti用户只能看到自己的</li>
<li>单独给activiti用户授PROCESS权限，（授权后需要退出重新登录）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show full processlist;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-7c7aa8c6b9d16573.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>show processlist 显示的信息都是来自MySQL系统库 <code>information_schema</code> 中的 <code>processlist</code> 表。所以使用下面的查询语句可以获得相同的结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.processlist</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-998bfd3c9af75563.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>查询出来的结果都是什么意思。</p>
<ul>
<li><p>Id: 就是这个线程的唯一标识，当我们发现这个线程有问题的时候，可以通过 kill 命令，加上这个Id值将这个线程杀掉。前面我们说了show processlist 显示的信息时来自<code>information_schema.processlist</code> 表，所以这个Id就是这个表的主键。</p>
</li>
<li><p>User: 就是指启动这个线程的用户。</p>
</li>
<li><p>Host: 记录了发送请求的客户端的 IP 和 端口号。通过这些信息在排查问题的时候，我们可以定位到是哪个客户端的哪个进程发送的请求。</p>
</li>
<li><p>DB: 当前执行的命令是在哪一个数据库上。如果没有指定数据库，则该值为 NULL 。</p>
</li>
<li><p>Command: 是指此刻该线程正在执行的命令。这个很复杂，下面单独解释</p>
</li>
<li><p>Time: 表示该线程处于当前状态的时间。</p>
</li>
<li><p>State: 线程的状态，和 Command 对应，下面单独解释。</p>
</li>
<li><p>Info: 一般记录的是线程执行的语句。默认只显示前100个字符，也就是你看到的语句可能是截断了的，要看全部信息，需要使用 show full processlist。</p>
</li>
</ul>
<p>##Command 的值：<br>通常是休眠（sleep），查询（query），连接（connect）<br>具体如下：</p>
<ul>
<li>Binlog Dump: 主节点正在将二进制日志 ，同步到从节点</li>
<li>Change User: 正在执行一个 change-user 的操作</li>
<li>Close Stmt: 正在关闭一个Prepared Statement 对象</li>
<li>Connect: 一个从节点连上了主节点</li>
<li>Connect Out: 一个从节点正在连主节点</li>
<li>Create DB: 正在执行一个create-database 的操作</li>
<li>Daemon: 服务器内部线程，而不是来自客户端的链接</li>
<li>Debug: 线程正在生成调试信息</li>
<li>Delayed Insert: 该线程是一个延迟插入的处理程序</li>
<li>Drop DB: 正在执行一个 drop-database 的操作</li>
<li>Execute: 正在执行一个 Prepared Statement</li>
<li>Fetch: 正在从Prepared Statement 中获取执行结果</li>
<li>Field List: 正在获取表的列信息</li>
<li>Init DB: 该线程正在选取一个默认的数据库</li>
<li>Kill : 正在执行 kill 语句，杀死指定线程</li>
<li>Long Data: 正在从Prepared Statement 中检索 long data</li>
<li>Ping: 正在处理 server-ping 的请求</li>
<li>Prepare: 该线程正在准备一个 Prepared Statement</li>
<li>ProcessList: 该线程正在生成服务器线程相关信息</li>
<li>Query: 该线程正在执行一个语句</li>
<li>Quit: 该线程正在退出</li>
<li>Refresh：该线程正在刷表，日志或缓存；或者在重置状态变量，或者在复制服务器信息</li>
<li>Register Slave： 正在注册从节点</li>
<li>Reset Stmt: 正在重置 prepared statement</li>
<li>Set Option: 正在设置或重置客户端的 statement-execution 选项</li>
<li>Shutdown: 正在关闭服务器</li>
<li>Sleep: 正在等待客户端向它发送执行语句</li>
<li>Statistics: 该线程正在生成 server-status 信息</li>
<li>Table Dump: 正在发送表的内容到从服务器</li>
<li>Time: Unused</li>
</ul>
<h2 id="state列-状态的值"><a href="#state列-状态的值" class="headerlink" title="state列 状态的值"></a>state列 状态的值</h2><ul>
<li>Checking table<br>正在检查数据表（这是自动的）。</li>
<li>Closing tables<br>正在将表中修改的数据刷新到磁盘中，同时正在关闭已经用完的表。这是一个很快的操作，如果不是这样的话，就应该确认磁盘空间是否已经满了或者磁盘是否正处于重负中。</li>
<li>Connect Out<br>复制从服务器正在连接主服务器。</li>
<li>Copying to tmp table on disk<br>由于临时结果集大于 tmp_table_size，正在将临时表从内存存储转为磁盘存储以此节省内存。</li>
<li>Creating tmp table<br>正在创建临时表以存放部分查询结果。</li>
<li>deleting from main table<br>服务器正在执行多表删除中的第一部分，刚删除第一个表。</li>
<li>deleting from reference tables<br>服务器正在执行多表删除中的第二部分，正在删除其他表的记录。</li>
<li>Flushing tables<br>正在执行 FLUSH TABLES，等待其他线程关闭数据表。</li>
<li>Killed<br>发送了一个kill请求给某线程，那么这个线程将会检查kill标志位，同时会放弃下一个kill请求。MySQL会在每次的主循环中检查kill标志位，不过有些情况下该线程可能会过一小段才能死掉。如果该线程程被其他线程锁住了，那么kill请求会在锁释放时马上生效。</li>
<li>Locked<br>被其他查询锁住了。</li>
<li>Sending data<br>正在处理 SELECT 查询的记录，同时正在把结果发送给客户端。</li>
<li>Sorting for group<br>正在为 GROUP BY 做排序。</li>
<li>Sorting for order<br>正在为 ORDER BY 做排序。</li>
<li>Opening tables<br>这个过程应该会很快，除非受到其他因素的干扰。例如，在执 ALTER TABLE 或 LOCK TABLE 语句行完以前，数据表无法被其他线程打开。 正尝试打开一个表。</li>
<li>Removing duplicates<br>正在执行一个 SELECT DISTINCT 方式的查询，但是MySQL无法在前一个阶段优化掉那些重复的记录。因此，MySQL需要再次去掉重复的记录，然后再把结果发送给客户端。</li>
<li>Reopen table<br>获得了对一个表的锁，但是必须在表结构修改之后才能获得这个锁。已经释放锁，关闭数据表，正尝试重新打开数据表。</li>
<li>Repair by sorting<br>修复指令正在排序以创建索引。</li>
<li>Repair with keycache<br>修复指令正在利用索引缓存一个一个地创建新索引。它会比 Repair by sorting 慢些。</li>
<li>Searching rows for update<br>正在讲符合条件的记录找出来以备更新。它必须在 UPDATE 要修改相关的记录之前就完成了。</li>
<li>Sleeping<br>正在等待客户端发送新请求.</li>
<li>System lock<br>正在等待取得一个外部的系统锁。如果当前没有运行多个 mysqld 服务器同时请求同一个表，那么可以通过增加 –skip-external-locking参数来禁止外部系统锁。</li>
<li>Upgrading lock<br>INSERT DELAYED 正在尝试取得一个锁表以插入新记录。</li>
<li>Updating<br>正在搜索匹配的记录，并且修改它们。</li>
<li>User Lock<br>正在等待 GET_LOCK()。</li>
<li>Waiting for tables<br>该线程得到通知，数据表结构已经被修改了，需要重新打开数据表以取得新的结构。然后，为了能的重新打开数据表，必须等到所有其他线程关闭这个表。以下几种情况下会产生这个通知：FLUSH TABLES tbl_name, ALTER TABLE, RENAME TABLE, REPAIR TABLE, ANALYZE TABLE, 或 OPTIMIZE TABLE。</li>
<li>waiting for handler insert<br>INSERT DELAYED 已经处理完了所有待处理的插入操作，正在等待新的请求。<br>大部分状态对应很快的操作，只要有一个线程保持同一个状态好几秒钟，那么可能是有问题发生了，需要检查一下。<br>还有其他的状态没在上面中列出来，不过它们大部分只是在查看服务器是否有存在错误是才用得着。</li>
</ul>
<h2 id="max-connections和max-user-connections"><a href="#max-connections和max-user-connections" class="headerlink" title="max_connections和max_user_connections"></a>max_connections和max_user_connections</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">max_connections 是数据库的最大连接数</span><br><span class="line">max_user_connections 是当前账号的最大连接数</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;查询数据库最大连接数</span><br><span class="line">SHOW VARIABLES LIKE &#39;%connections%&#39;;  </span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-cde3b59efb59c2d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW STATUS LIKE &#39;%Connection%&#39;; </span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-2b883e75734c29ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>max_used_connections / max_connections * 100% （理想值≈ 85%）<br>17/1024=0.01660</p>
<p>如果max_used_connections跟max_connections相同 那么就是max_connections设置过低或者超过服务器负载上限了，低于10%则设置过大。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show status like  &#39;Threads%&#39;;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-62e32ce0291f32f7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<ul>
<li>Threads_connected ：这个数值指的是打开的连接数.</li>
<li>Threads_running ：这个数值指的是激活的连接数，这个数值一般远低于connected数值.</li>
<li>Threads_connected 跟show processlist结果相同，表示当前连接数。准确的来说，Threads_running是代表当前并发数</li>
</ul>
<p>查询数据库当前设置的最大连接数<br>###设置这个最大连接数值</p>
<p><strong>方法1：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set global max_connections&#x3D;1024;</span><br><span class="line">show variables like &#39;%max_connections%&#39;;</span><br></pre></td></tr></table></figure>
<p>这种 方式在Mysql重启后就失效。</p>
<p><strong>方法2：</strong><br>修改mysql配置文件my.cnf，在[mysqld]段中添加或修改max_connections值：<br>max_connections=1024<br>重启mysql服务即可。</p>
<p><strong>方法3：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT USAGE ON *.* TO &#39;root&#39;@&#39;localhost&#39; WITH MAX_USER_CONNECTIONS 10;</span><br></pre></td></tr></table></figure>




<h1 id="三-sleep-函数"><a href="#三-sleep-函数" class="headerlink" title="三. sleep()函数"></a>三. sleep()函数</h1><blockquote>
<p>与Java中的Thread.sleep()类似；<br>但也有很大的不同，其休眠数字是针对的每条记录</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;休眠两秒查询出结果</span><br><span class="line">select sleep(2);</span><br></pre></td></tr></table></figure>

<p><strong>如product数据如下：</strong><br><img src="https://upload-images.jianshu.io/upload_images/19382524-7262446bdc320496.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>查询出两条数据如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-6bdb6d99159d1442.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>如果加上sleep()函数：<br><img src="https://upload-images.jianshu.io/upload_images/19382524-2360558e820ab219.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>如果查不到数据：<br><img src="https://upload-images.jianshu.io/upload_images/19382524-40ece872d3428784.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>所以，耗时跟数据条数据有关；</p>
<p>#四.创建用户并分配权限</p>
<p>##创建新用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;方法1   username:用户名；host：指定在哪个主机上可以登录，本机可用localhost，%通配所有远程主机；password：用户登录密码；</span><br><span class="line">CREATE USER &#39;username&#39;@&#39;host&#39; IDENTIFIED BY &#39;password&#39;;</span><br><span class="line">&#x2F;&#x2F;方法2</span><br><span class="line">insert into mysql.user(Host,User,Password) values(&quot;localhost&quot;,&quot;userName&quot;,password(&quot;1q2w3e4r&quot;));</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
<p>##分配权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;格式：grant 权限 on 数据库名.表名 to 用户@登录主机 identified by “用户密码”；.代表所有权；</span><br><span class="line">&#x2F;&#x2F; 后面是访问MySQL的客户端IP地址（或是 主机名） % 代表任意的客户端，如果填写 localhost 为本地访问（那此用户就不能远程访问该mysql数据库了）。</span><br><span class="line">grant all privileges on databaseName.* to UserName@localhost identified by &#39;1q2w3e4r&#39;;</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>
<p>完成以上流程就实现了一个基本的用户生成并配置权限，如果需要控制用的CURD操作更改相关的权限即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">all privileges包含以下权限:</span><br><span class="line">select,</span><br><span class="line">insert,</span><br><span class="line">update,</span><br><span class="line">delete,</span><br><span class="line">create,</span><br><span class="line">drop,</span><br><span class="line">references,</span><br><span class="line">index,</span><br><span class="line">alter,</span><br><span class="line">create temporary tables,</span><br><span class="line">lock tables,</span><br><span class="line">execute,</span><br><span class="line">create view,</span><br><span class="line">show view,</span><br><span class="line">create routine,</span><br><span class="line">alter routine,</span><br><span class="line">event,</span><br><span class="line">trigger</span><br></pre></td></tr></table></figure>

<p>mysql的权限命令是grant，权限撤销的命令时revoke；<br>grant授权格式：grant 权限列表 on 库.表 to 用户名@’ip’ identified by “密码”;<br>revoke回收权限格式：revoke 权限列表 on 库.表 from 用户名@’ip’;</p>
<p>#一些备注sql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">按客户端 IP 分组，看哪个客户端的链接数最多</span><br><span class="line">select client_ip,count(client_ip) as client_num from (select substring_index(host,&#39;:&#39; ,1) as client_ip from processlist ) as connect_info group by client_ip order by client_num desc;</span><br><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">查看正在执行的线程，并按 Time 倒排序，看看有没有执行时间特别长的线程</span><br><span class="line">select * from information_schema.processlist where Command !&#x3D; &#39;Sleep&#39; order by Time desc;</span><br><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">找出所有执行时间超过 5 分钟的线程，拼凑出 kill 语句，方便后面查杀</span><br><span class="line">select concat(&#39;kill &#39;, id, &#39;;&#39;) from information_schema.processlist where Command !&#x3D; &#39;Sleep&#39; and Time &gt; 300 order by Time desc;</span><br><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">show processlist中kill锁表语句与慢sql</span><br><span class="line">单个kill</span><br><span class="line">mysql&gt; show processlist;</span><br><span class="line">mysql &gt; kill 251;</span><br><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">批量kill</span><br><span class="line">1)查找Lockd语句</span><br><span class="line">mysql -uroot -p123456 -h 192.1.20.101 -e &quot;show processlist&quot; | grep -i &#39;Locked&#39; &gt; locked_log.txt</span><br><span class="line">2）组合kill</span><br><span class="line">for line in &#96;cat locked_log.txt | awk &#39;&#123;print $1&#125;&#39;&#96;</span><br><span class="line">do </span><br><span class="line">   echo &quot;kill $line;&quot; &gt;&gt; kill_thread_id.sql</span><br><span class="line">done</span><br><span class="line">3)执行</span><br><span class="line">mysql&gt;source kill_thread_id.sql</span><br><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">1、kill所有慢查询进程：</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">mysql -uroot -pMy_Password -e &quot;show processlist&quot; | grep -i &quot;Query&quot; &gt; slow_query.log</span><br><span class="line">for query in &#96;cat slow_query.log | awk &#39;&#123;print $1&#125;&#39;&#96;</span><br><span class="line">do</span><br><span class="line">   echo &quot;kill $query;&quot; &gt; kill_slow_query.sql</span><br><span class="line">done</span><br><span class="line">登录mysql，执行：</span><br><span class="line">mysql&gt; source kill_slow_query.sql</span><br><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">或者：</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">for query in &#96;mysqladmin -uroot -pMy_Password processlist | grep -i &#39;Query&#39; | awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line">do</span><br><span class="line">   mysqladmin kill $&#123;query&#125;</span><br><span class="line">done</span><br><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">2、kill所有死锁进程：</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">mysql -uroot -pMy_Password -e &quot;show processlist&quot; | grep -i &quot;Locked&quot; &gt; locked.log</span><br><span class="line"></span><br><span class="line">for lock in &#96;cat locked.log | awk &#39;&#123;print $1&#125;&#39;&#96;</span><br><span class="line">do</span><br><span class="line">   echo &quot;kill $lock;&quot; &gt; kill_locked.sql</span><br><span class="line">done</span><br><span class="line">登录mysql，执行：</span><br><span class="line">mysql&gt; source kill_locked.sql</span><br><span class="line">&#x2F;&#x2F;------------------------</span><br><span class="line">或者：</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">for lock in &#96;mysqladmin -uroot -pMy_Password processlist | grep -i &#39;Locked&#39; | awk &#39;&#123;print $2&#125;&#39;&#96;</span><br><span class="line">do</span><br><span class="line">   mysqladmin kill $&#123;lock&#125;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>参考<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b05a0f8a8da5">mysql: show processlist 详解</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/gumanren/article/details/4658385">Mysql 中 show full processlist</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/wujuntian/p/6624478.html">MySQL常用配置参数</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhu19774279/article/details/38669229">预防MySQL宕机：合理设置MySQL最大用户连接数</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fansik/p/7054869.html">MySQL中kill所有慢查询进程和锁表进程</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kevingrace/p/5719536.html">MySQL 操作命令梳理（4）– grant授权和revoke回收权限</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-mysql/mysql-事务相关的概念和理论ACID、CAP、BASE"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/14/mysql/mysql-%E4%BA%8B%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E7%90%86%E8%AE%BAACID%E3%80%81CAP%E3%80%81BASE/"
    >mysql-事务相关的概念和理论ACID、CAP、BASE</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/14/mysql/mysql-%E4%BA%8B%E5%8A%A1%E7%9B%B8%E5%85%B3%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E7%90%86%E8%AE%BAACID%E3%80%81CAP%E3%80%81BASE/" class="article-date">
  <time datetime="2020-07-14T14:36:00.000Z" itemprop="datePublished">2020-07-14</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="基础理论"><a href="#基础理论" class="headerlink" title="基础理论"></a>基础理论</h1><p>先简单介绍下数据一致性的基础理论。</p>
<ul>
<li><p>强一致 <br>  当更新操作完成之后，任何多个后续进程或者线程的访问都会返回最新的更新过的值。这种是对用户最友好的，就是用户上一次写什么，下一次就保证能读到什么。根据 CAP 理论，这种实现需要牺牲可用性。</p>
</li>
<li><p>弱一致性 <br>  系统并不保证续进程或者线程的访问都会返回最新的更新过的值。系统在数据写入成功之后，不承诺立即可以读到最新写入的值，也不会具体的承诺多久之后可以读到。</p>
</li>
<li><p>最终一致性 <br>  弱一致性的特定形式。系统保证在没有后续更新的前提下，系统能最终返回上一次更新操作的值。在没有故障发生的前提下，不一致窗口的时间主要受通信延迟，系统负载和复制副本的个数影响。DNS 是一个典型的最终一致性系统。</p>
</li>
</ul>
<h1 id="ACID模型"><a href="#ACID模型" class="headerlink" title="ACID模型"></a>ACID模型</h1><p>ACID是传统数据库常用的设计理念，追求强一致性模型。 <br>关系数据库的ACID模型拥有 高一致性 + 可用性 很难进行分区： </p>
<ul>
<li>Atomicity原子性：一个事务中所有操作都必须全部完成，要么全部不完成。 </li>
<li>Consistency一致性. 在事务开始或结束时，数据库应该在一致状态。 </li>
<li>Isolation隔离层. 事务将假定只有它自己在操作数据库，彼此不知晓。 </li>
<li>Durability. 一旦事务完成，就不能返回。</li>
</ul>
<p>ACID模型要求一个事物必须满足上面的四点，这是对关系型传统数据库的指导性依据。而非关系型数据库NoSql则不再依赖这一模型。</p>
<h1 id="CAP理论"><a href="#CAP理论" class="headerlink" title="CAP理论"></a>CAP理论</h1><p>2000年7月，加州大学伯克利分校的Eric Brewer教授在ACM PODC会议上提出CAP猜想。2年后，麻省理工学院的Seth Gilbert和Nancy Lynch从理论上证明了CAP。之后，CAP理论正式成为分布式计算领域的公认定理。</p>
<p>CAP理论为： <br>一个分布式系统最多只能同时满足</p>
<ul>
<li>  Consistency(一致性), 数据一致更新，所有数据变动都是同步的</li>
<li>  Availability(可用性), 好的响应性能</li>
<li>  Partition tolerance(分区容错性) 可靠性</li>
</ul>
<p>这三项中的两项。</p>
<blockquote>
<p>传统选CA,互联网选AP<br>传统的关系型数据库会选择 CA<br>而 Nosql会关注AP。</p>
</blockquote>
<h1 id="BASE理论"><a href="#BASE理论" class="headerlink" title="BASE理论"></a>BASE理论</h1><p>BASE:Basically,Available,Soft state,Eventually consistent四个词组的首字母,它的意思是：基本可用+软状态+最终一致性 <br>eBay的架构师Dan Pritchett源于对大规模分布式系统的实践总结，在ACM上发表文章提出BASE理论，BASE理论是对CAP理论的延伸，核心思想是即使无法做到强一致性（Strong Consistency，CAP的一致性就是强一致性），但应用可以采用适合的方式达到最终一致性（Eventual Consitency）。</p>
<p>BASE是指基本可用（Basically Available）、软状态（ Soft State）、最终一致性（ Eventual Consistency）。</p>
<ul>
<li><p>基本可用（Basically Available） <br>  基本可用是指分布式系统在出现故障的时候，允许损失部分可用性，即保证核心可用。 <br>  电商大促时，为了应对访问量激增，部分用户可能会被引导到降级页面，服务层也可能只提供降级服务。这就是损失部分可用性的体现。</p>
</li>
<li><p>软状态（ Soft State） <br>  软状态是指允许系统存在中间状态，而该中间状态不会影响系统整体可用性。分布式存储中一般一份数据至少会有三个副本，允许不同节点间副本同步的延时就是软状态的体现。mysql replication的异步复制也是一种体现。</p>
</li>
<li><p>最终一致性（ Eventual Consistency） <br>  最终一致性是指系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。弱一致性和强一致性相反，最终一致性是弱一致性的一种特殊情况。</p>
</li>
</ul>
<p>BASE模型是传统ACID模型的反面，不同与ACID，BASE强调牺牲高一致性，从而获得可用性，数据<strong>允许在一段时间内的不一致，只要保证最终一致就可以了</strong>。</p>
<p>BASE模型反ACID模型，完全不同ACID模型，牺牲高一致性，获得可用性或可靠性： Basically Available基本可用。支持分区失败(e.g. sharding碎片划分数据库) Soft state软状态 状态可以有一段时间不同步，异步。 Eventually consistent最终一致，最终数据是一致的就可以了，而不是时时一致。</p>
<p>BASE思想的主要实现有 </p>
<ul>
<li>1.按功能划分数据库 </li>
<li>2.sharding碎片</li>
</ul>
<p>BASE思想主要强调基本的可用性，如果你需要高可用性，也就是纯粹的高性能，那么就要以一致性或容错性为牺牲，BASE思想的方案在性能上还是有潜力可挖的。</p>
<p>现在NoSQL运动丰富了拓展了BASE思想，可按照具体情况定制特别方案，比如忽视一致性，获得高可用性等等，NOSQL应该有下面两个流派： </p>
<ul>
<li><ol>
<li>Key-Value存储，如Amaze Dynamo等，可根据CAP三原则灵活选择不同倾向的数据库产品。 </li>
</ol>
</li>
<li><ol start="2">
<li>领域模型 + 分布式缓存 + 存储 （Qi4j和NoSQL运动），可根据CAP三原则结合自己项目定制灵活的分布式方案，难度高。</li>
</ol>
</li>
</ul>
<p>这两者共同点：都是关系数据库SQL以外的可选方案，逻辑随着数据分布，任何模型都可以自己持久化，将数据处理和数据存储分离，将读和写分离，存储可以是异步或同步，取决于对一致性的要求程度。</p>
<p>不同点：NOSQL之类的Key-Value存储产品是和关系数据库头碰头的产品BOX，可以适合非Java如PHP RUBY等领域，是一种可以拿来就用的产品，而领域模型 +分布式缓存 + 存储是一种复杂的架构解决方案，不是产品，但这种方式更灵活，更应该是架构师必须掌握的。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zjcjava/article/details/78893368">事务原理：ACID,CAP和BASE理论及分布式事务一致性案例</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9156a1bec34c">Base/ACID/CAP 有什么关系</a><br> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/linbingdong/p/6178488.html">分布式系列文章——从ACID到CAP/BASE</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/linqichen/article/details/96592040">谈谈CAP，BASE, ACID</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-mysql/mysql事务"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/13/mysql/mysql%E4%BA%8B%E5%8A%A1/"
    >mysql事务</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/13/mysql/mysql%E4%BA%8B%E5%8A%A1/" class="article-date">
  <time datetime="2020-07-13T14:36:00.000Z" itemprop="datePublished">2020-07-13</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p><strong>MySQL 事务</strong><br>MySQL 事务主要用于处理操作量大，复杂度高的数据。比如说，在人员管理系统中，你删除一个人员，你即需要删除人员的基本资料，也要删除和该人员相关的信息，如信箱，文章等等，这样，这些数据库操作语句就构成一个事务！</p>
<ul>
<li>在 MySQL 中只有使用了 Innodb 数据库引擎的数据库或表才支持事务。</li>
<li>事务处理可以用来维护数据库的完整性，保证成批的 SQL 语句要么全部执行，要么全部不执行。</li>
<li>事务用来管理 insert,update,delete 语句</li>
</ul>
<p>一般来说，事务是必须满足4个条件（ACID）：<code>原子性（Atomicity，或称不可分割性）</code>、<code>一致性（Consistency）</code>、<code>隔离性（Isolation，又称独立性）</code>、<code>持久性（Durability）</code>。</p>
<ul>
<li><p>原子性：一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。</p>
</li>
<li><p>一致性：在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。</p>
</li>
<li><p>隔离性：数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。</p>
</li>
<li><p>持久性：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。</p>
</li>
</ul>
<blockquote>
<p>在 mysql 命令行的默认设置下，事务都是自动提交的，即执行 sql 语句后就会马上执行 commit 操作。因此要显式地开启一个事务务须使用命令 begin 或 start transaction，或者执行命令 set autocommit=0，用来禁止使用当前会话的自动提交。</p>
</blockquote>
<p><strong>事务控制语句：</strong></p>
<ul>
<li><p>begin 或 start transaction 显式地开启一个事务；</p>
</li>
<li><p>commit 也可以使用 commit work，不过二者是等价的。commit 会提交事务，并使已对数据库进行的所有修改成为永久性的；</p>
</li>
<li><p>rollback 也可以使用 rollback work，不过二者是等价的。回滚会结束用户的事务，并撤销正在进行的所有未提交的修改；</p>
</li>
<li><p>savepoint identifier，savepoint 允许在事务中创建一个保存点，一个事务中可以有多个 savepoint；</p>
</li>
<li><p>release savepoint identifier 删除一个事务的保存点，当没有指定的保存点时，执行该语句会抛出一个异常；</p>
</li>
<li><p>rollback to identifier 把事务回滚到标记点；</p>
</li>
<li><p>set transaction 用来设置事务的隔离级别。innodb 存储引擎提供事务的隔离级别有read uncommitted、read committed、repeatable read 和 serializable。</p>
</li>
<li><p>show variables like ‘t_isolation’查询事务的隔离级别</p>
</li>
<li><p>set session transaction isolation level 级别名设置事务隔离级别</p>
</li>
</ul>
<blockquote>
<p>savepoint 是在数据库事务处理中实现“子事务”（subtransaction），也称为嵌套事务的方法。事务可以回滚到 savepoint 而不影响 savepoint 创建前的变化, 不需要放弃整个事务。<br>rollback 回滚的用法可以设置保留点 savepoint，执行多条操作时，回滚到想要的那条语句之前。</p>
</blockquote>
<blockquote>
<p>使用 savepoint<br>savepoint savepoint_name;    // 声明一个 savepoint<br>rollback to savepoint_name;  // 回滚到savepoint</p>
</blockquote>
<blockquote>
<p>删除 savepoint<br>保留点再事务处理完成（执行一条 rollback 或 commit）后自动释放。<br>mysql5 以来，可以用:<br>release savepoint savepoint_name;  // 删除指定保留点</p>
</blockquote>
<p><strong>MYSQL 事务处理主要有两种方法：</strong></p>
<ol>
<li>用 begin, rollback, commit来实现<br>begin 开始一个事务<br>rollback 事务回滚<br>commit 事务确认</li>
<li>直接用 set 来改变 mysql 的自动提交模式:<br>set autocommit=0 禁止自动提交<br>set autocommit=1 开启自动提交</li>
</ol>
<p><strong>脏读、不可重复读、幻读、第一类丢失更新、第二类丢失更新</strong></p>
<ul>
<li><p>脏读<br>事务A读到（就是select语句）事务B 尚未提交的修改（insert、delete、update）。脏读的后果：事务A读到事务B做的修改，如果事务B发生事务回滚，则事务A读取到的就是垃圾数据。（注：脏读的后果很严重）<br>e.g.</p>
<pre><code>  1.Mary的原工资为1000, 财务人员将Mary的工资改为了8000(但未提交事务)
  2.Mary读取自己的工资 ,发现自己的工资变为了8000，欢天喜地！
  3.而财务发现操作有误，回滚了事务,Mary的工资又变为了1000
    像这样,Mary记取的工资数8000是一个脏数据。</code></pre>
</li>
<li><p>不可重复读<br>同一个事务再次读取数据时，与之前读取到的数据不一致。（注：如果允许不重复读，则读取到的数据是不确定的。）<br>e.g.<br>  1.在事务1中，Mary 读取了自己的工资为1000,操作并没有完成<br>  2.在事务2中，这时财务人员修改了Mary的工资为2000,并提交了事务.<br>  3.在事务1中，Mary 再次读取自己的工资时，工资变为了2000</p>
<p>解决办法：如果只有在修改事务完全提交之后才可以读取数据，则可以避免该问题。</p>
</li>
<li><p>虚读（幻读）<br>事务A读取到where子句指定的数据，事务B加入了一行与事务A的where条件一样的数据。然后事务A再次使用相同的查询条件读取，此时事务A看到的可能就是事务B所添加的。<br>e.g.<br> 目前工资为1000的员工有10人。<br> 1.事务1,读取所有工资为1000的员工。<br> 2.这时事务2向employee表插入了一条员工记录，工资也为1000<br> 3.事务1再次读取所有工资为1000的员工 共读取到了11条记录， </p>
<p>解决办法：如果在操作事务完成数据处理之前，任何其他事务都不可以添加新数据，则可避免该问题</p>
</li>
<li><p>第一类丢失更新<br>撤销一个事务时, 把其他事务已经提交的更新数据覆盖(此情况在事务中不可能出现, 因为一个事务中修改时此记录已加锁, 必须等待此事务完成后另一个事务才可以继续UPDATE)</p>
</li>
<li><p>第二类丢失更新<br>这是不可重复读中的特例, 一个事务覆盖另一个事务已提交的更新数据</p>
</li>
</ul>
<blockquote>
<p>不可重复读的重点是修改 :<br>同样的条件, 你读取过的数据,再次读取出来发现值不一样了<br> 幻读的重点在于新增或者删除<br>同样的条件, 第 1 次和第 2 次读出来的记录数不一样</p>
</blockquote>
<p>在一个程序中，依据事务的隔离级别将会有三种情况发生。
　　</p>
<ul>
<li><p>脏读：一个事务会读进还没有被另一个事务提交的数据，所以你会看到一些最后被另一个事务回滚掉的数据。</p>
</li>
<li><p>不可重复读：一个事务读进一条记录，另一个事务更改了这条记录并提交完毕，这时候第一个事务再次读这条记录时，它已经改变了。</p>
</li>
<li><p>幻读：一个事务用Where子句来检索一个表的数据，另一个事务插入一条新的记录，并且符合Where条件，这样，第一个事务用同一个where条件来检索数据后，就会多出一条记录。</p>
</li>
</ul>
<p><strong>数据库提供了四种隔离级别</strong><br>因此数据库提供了四种隔离级别来解决上面的问题， 不同的隔离级别采用不同的锁类开来实现. </p>
<ul>
<li><p>1.读未提交（read uncommitted  最低级别）<br>读取尚未提交的数据，哪一个问题都不能解决。</p>
</li>
<li><p>2.读已提交（read committed）<br>读取已经提交的数据，可以解决脏读。（oracle、sql Server默认）</p>
</li>
<li><p>3.可重复读（repeatable read）<br>可以解决脏读和不重复读取。（mysql默认）</p>
</li>
<li><p>4.串行化（serializable 最高级别）<br>可以解决脏读、不重复读、虚读。（相当于锁表）</p>
</li>
</ul>
<blockquote>
<p>事务的隔离级别越高，隔离性越强，所拥有的问题越少，并发能力越弱，所以，我们可以用如下表格进行总结</p>
</blockquote>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th align="center">脏读</th>
<th align="center">不可重复读</th>
<th align="center">幻读</th>
</tr>
</thead>
<tbody><tr>
<td>Read uncommitted (未提交读)</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>Read committed (已提交读)</td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td>Repeatable read(可重复读)</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">√</td>
</tr>
<tr>
<td>Serializable(可串行化)</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">×</td>
</tr>
</tbody></table>
<p>参考<br><a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-transaction.html">MySQL 事务</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/owen_l_y/article/details/85945816">MySQL事务</a><br><a target="_blank" rel="noopener" href="https://www.iteye.com/blog/uule-1109647">脏读、幻读和不可重复读 + 事务隔离级别</a><br><a target="_blank" rel="noopener" href="http://www.zsythink.net/archives/1216">mysql/mariadb知识点总结（20）：事务控制语句 (事务总结之二)</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-mysql/mysql课堂笔记"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/12/mysql/mysql%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/"
    >mysql课堂笔记</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/12/mysql/mysql%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-07-12T14:36:00.000Z" itemprop="datePublished">2020-07-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="一、SQL简介"><a href="#一、SQL简介" class="headerlink" title="一、SQL简介"></a>一、SQL简介</h1><p><code>Structured Query Language</code>结构化查询语言</p>
<p><code>作用：</code>是一种定义、操作、管理关系数据库的句法。</p>
<p>结构化查询语言的工业标准由ANSI(美国国家标准学会，ISO的成员之一)维护。各大数据库厂商都支持ANSI的SQL标准，但也都对SQL进行了扩展。<br>SQL：标准和扩展的东西（方言）</p>
<h1 id="二、SQL语句的组成（Structure-Query-Language）"><a href="#二、SQL语句的组成（Structure-Query-Language）" class="headerlink" title="二、SQL语句的组成（Structure Query Language）"></a>二、SQL语句的组成（Structure Query Language）</h1><ul>
<li>DQL：数据查询语言（Data Query Languagg）</li>
</ul>
<p><strong>基本结构是由SELECT子句，FROM子句和WHERE子句组成的查询块（重点！！！！！）</strong><br>具体查看 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44541001/article/details/86582725">sql组成语言 3 ——DQL（数据查询语言）</a></p>
<ul>
<li>DML：数据操作语言（Data Manipulation Language）</li>
</ul>
<p><strong>用于数据库表中插入，删除，修改</strong><br>具体查看 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44541001/article/details/86574500">sql组成语言 2 ——DML（数据操作语言）以及方法</a></p>
<ul>
<li>DDL：数据定义语言（Data Definition Language）</li>
</ul>
<p><strong>主要用于数据库,表,视图,索引,等操作</strong><br>可以理解为 数据库的增删改查以及数据库表的增删改查<br>具体查看 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44541001/article/details/86549500">sql组成语言 1 – DDL（数据定义语言）数据表的基本操作</a></p>
<ul>
<li>DCL：数据控制语言（Data Control Language）该部分转自博客 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39703170/article/details/79011704%EF%BC%89">https://blog.csdn.net/weixin_39703170/article/details/79011704</a><br>专门对数据库的权限进行设置等操作，用来授予或回收访问数据库的某种特权，并控制数据库操纵事务发生的时间及效果，对数据库实行监视等。<br>如：<ul>
<li>（1) <code>GRANT</code>：授权。</li>
<li>（2) <code>ROLLBACK [WORK] TO [SAVEPOINT]</code>：回退到某一点。<br>回滚—ROLLBACK<br>回滚命令使数据库状态回到上次最后提交的状态。其格式为：<br><code>&gt;ROLLBACK;</code></li>
<li>（3)<code> COMMIT [WORK]</code>：提交。<br>在数据库的插入、删除和修改操作时，只有当事务在提交到数据<br>库时才算完成。在事务提交前，只有操作数据库的这个人才能有权看<br>到所做的事情，别人只有在最后提交完成后才可以看到。<br>提交数据有三种类型：显式提交、隐式提交及自动提交。下面分<br>别说明这三种类型。</li>
<li>(1) 显式提交<br>用<code>COMMIT</code>命令直接完成的提交为显式提交。其格式为：<br><code>&gt;COMMIT；</code></li>
<li>(2) 隐式提交<br>用<code>SQL</code>命令间接完成的提交为隐式提交。这些命令是：<br><code>ALTER，AUDIT，COMMENT，CONNECT，CREATE，DISCONNECT，DROP，EXIT，GRANT，NOAUDIT，QUIT，REVOKE，RENAME。</code></li>
<li>(3) 自动提交<br>若把<code>AUTOCOMMIT</code>设置为<code>ON</code>，则在插入、修改、删除语句执行后，<br>系统将自动进行提交，这就是自动提交。其格式为：<br><code>&gt;SET AUTOCOMMIT ON；</code></li>
</ul>
</li>
<li>TPL：事务处理语言  (Transaction Processing Language)</li>
</ul>
<p><strong>它的语句能确保被DML语句影响的表的所有行及时得以更新。TPL语句包括BEGIN TRANSACTION，COMMIT和ROLLBACK。</strong><br><strong>特点： 要么成功，要么失败</strong><br>具体查看 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44541001/article/details/86599597">sql组成语言 4 ——TPL（事务处理语言）</a></p>
<ul>
<li>CCL：指针控制语言</li>
</ul>
<p><strong>它的语句，像DECLARE CURSOR，FETCH INTO和UPDATE WHERE CURRENT用于对一个或多个表单独行的操作。</strong></p>
<p><code>参考</code> <a target="_blank" rel="noopener" href="http://ddrv.cn/a/297127">sql语言组成部分（DDL,DML,DQL,DCL,TPL,CCL）</a></p>
<h1 id="三、常用的数据库"><a href="#三、常用的数据库" class="headerlink" title="三、常用的数据库"></a>三、常用的数据库</h1><ul>
<li>Oracle</li>
<li>DB2</li>
<li>MySQL</li>
<li>SQLServer<h1 id="四、MySQL的安装与配置"><a href="#四、MySQL的安装与配置" class="headerlink" title="四、MySQL的安装与配置"></a>四、MySQL的安装与配置</h1><code>大小问题：</code>MySQL在window系统下不区分大小写的。<br>在其他系统严格区分大小写。</li>
</ul>
<p>验证是否安装配置成功：<br><code>mysql -u root -p</code></p>
<p><code>总结：（Hibernate）</code><br> Java类和表结构对应的。<br> java对象和表中的一条记录是对应的。</p>
<h1 id="五、DDL：数据定义语言"><a href="#五、DDL：数据定义语言" class="headerlink" title="五、DDL：数据定义语言"></a>五、DDL：数据定义语言</h1><p><code>作用：</code>用于描述数据库中要存储的现实世界实体的语言。即创建数据库和表的结构。<br>常用关键字：<code>CREATE ALTER DROP TRUNCATE</code><br><strong>库操作</strong></p>
<ul>
<li>显示所有的数据库<br><code>SHOW DATABASES;</code></li>
<li>创建一个名称为mydb1的数据库。<br><code>CREATE DATABASE mydb1;</code></li>
<li>查看数据库的创建细节，可以看到使用的字符集。<br><code>SHOW CREATE DATABASE mydb1;</code></li>
<li>创建一个使用gbk字符集的mydb2数据库。<br><code>CREATE DATABASE mydb2 CHARACTER SET gbk;</code></li>
<li>创建一个使用gbk字符集，并带校对规则的mydb3数据库。<br><code>CREATE DATABASE mydb3 CHARACTER SET gbk COLLATE gbk_chinese_ci;</code></li>
<li>删除前面创建的mydb3数据库<br><code>DROP DATABASE mydb3;</code></li>
<li>查看服务器中的数据库，并把mydb2的字符集修改为utf8;<br><code>ALTER DATABASE mydb2 CHARACTER SET utf8;</code></li>
</ul>
<p><strong>表结构操作</strong></p>
<ul>
<li>显示当前的数据库<br><code>SELECT DATABASE();</code></li>
<li>选择数据库<br><code>USE mydb1;</code></li>
<li>创建一个员工表<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE employee(</span><br><span class="line">		id int,</span><br><span class="line">		name varchar(100),</span><br><span class="line">		gender varchar(10),</span><br><span class="line">		birthday date,</span><br><span class="line">		entry_date date,</span><br><span class="line">		job varchar(100),</span><br><span class="line">		salary float(8,2),</span><br><span class="line">		resume text</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li>
<li>查看库中的所有表格<br><code>SHOW TABLES;</code></li>
<li>查看表的结构<br><code>DESC employee;</code></li>
<li>查看表的创建细节<br><code>SHOW CREATE TABLE employee;</code></li>
<li>在上面员工表的基本上增加一个image列。<br><code>ALTER TABLE employee ADD image blob;</code></li>
<li>修改job列，使其长度为60。<br><code>ALTER TABLE employee MODIFY job varchar(60);</code></li>
<li>删除image列。<br><code>ALTER TABLE employee DROP image;</code></li>
<li>表名改为user。<br><code>RENAME TABLE employee TO user;</code></li>
<li>修改表的字符集为utf8<br><code>ALTER TABLE user CHARACTER SET utf8;</code></li>
<li>列名name修改为username<br><code>ALTER TABLE user CHANGE name username varchar(100);</code><h1 id="六、DML：数据操作语言"><a href="#六、DML：数据操作语言" class="headerlink" title="六、DML：数据操作语言"></a>六、DML：数据操作语言</h1><code>作用：</code>用于向数据库表中插入、删除、修改数据<br><code>常用关键字：INSERT UPDATE DELETE</code></li>
</ul>
<p><code>特别注意：MySQL，字符串或日期要包含在单引号中。</code><br><code>空值：NULL</code></p>
<ul>
<li>查看表中的所有记录<br><code>SELECT * FROM user;</code></li>
<li>使用insert语句向表中插入三个员工的信息。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO user VALUES (1,&#39;zxn&#39;,&#39;female&#39;,&#39;1995-12-02&#39;,&#39;2014-09-16&#39;,&#39;CEO&#39;,100000,&#39;beauty&#39;);</span><br><span class="line">INSERT INTO user(id,username,gender,birthday,entry_date,job,salary,resume) VALUES (2,&#39;lyx&#39;,&#39;male&#39;,&#39;1945-12-02&#39;,&#39;2014-09-16&#39;,&#39;UFO&#39;,100000,&#39;beates&#39;);</span><br></pre></td></tr></table></figure></li>
<li>插入中文数据：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW VARIABLES LIKE &#39;character%&#39;;</span><br><span class="line">+--------------------------+-----------------------+</span><br><span class="line">| Variable_name            | Value  |+--------------------------+------------</span><br><span class="line">-----------+</span><br><span class="line">		| character_set_client     | utf8   *客户端使用的编码</span><br><span class="line">				   |</span><br><span class="line">		| character_set_connection | utf8	数据库连接时使用的编码</span><br><span class="line">				   |</span><br><span class="line">		| character_set_database   | utf8	数据库用的编码</span><br><span class="line">				   |</span><br><span class="line">		| character_set_results    | utf8	*查询结果集用的编码</span><br><span class="line">				   |</span><br><span class="line">		| character_set_server     | utf8	服务器使用的编码</span><br><span class="line">				   |</span><br><span class="line">		| character_set_system     | utf8	系统使用的编码</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p><strong>用可视化的工具是没有这个问题的。</strong><br><strong>告知服务器客户端使用的编码：</strong><br><code>SET character_set_client=gbk;</code><br><strong>告知服务器返回的结果集请使用UTF8</strong><br><code>SET character_set_results=gbk;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO user(id,username,gender,birthday,entry_date,job,salary,resume)VALUES (3,&#39;杜小文&#39;,&#39;male&#39;,&#39;1935-12-02&#39;,&#39;2014-09-16&#39;,&#39;CTO&#39;,100000,&#39;杜总&#39;);&#96;</span><br></pre></td></tr></table></figure>
<ul>
<li>将所有员工薪水修改为5000元。<br><code>UPDATE user SET salary=5000;</code></li>
<li>将姓名为’zxn’的员工薪水修改为3000元。<br><code>UPDATE user SET salary=3000 WHERE username=&#39;zxn&#39;;</code></li>
<li>将姓名为’lyx’的员工薪水修改为4000元,job改为ccc。<br><code>UPDATE user SET salary=4000,job=&#39;OOO&#39; WHERE username=&#39;lyx&#39;;</code></li>
<li>将杜小文的薪水在原有基础上增加1000元。<br><code>UPDATE user SET salary=salary+1000 WHERE username=&#39;杜小文&#39;;</code></li>
<li>删除表中名称为’zxn’的记录。<br><code>DELETE FROM user WHERE username=&#39;zxn&#39;;</code></li>
<li>删除表中所有记录。<br><code>DELETE FROM user;(一条一条的删除)</code></li>
<li>使用truncate删除表中记录<br><code>TRUNCATE TABLE user;</code></li>
</ul>
<p><strong>(摧毁整张表格，重新建立表结构)</strong></p>
<h1 id="七、DQL：数据查询语言"><a href="#七、DQL：数据查询语言" class="headerlink" title="七、DQL：数据查询语言"></a>七、DQL：数据查询语言</h1><p><code>DQL:Data Query Language</code><br><code>作用：</code>查询数据，返回结果集。<br>常用关键字：<br><code>SELECT</code></p>
<ul>
<li>查询表中所有学生的信息。<br><code>SELECT * FROM student;</code></li>
<li>查询表中所有学生的姓名和对应的英语成绩。<br><code>SELECT name,english FROM student;</code></li>
<li>过滤表中重复数据。<br><code>SELECT DISTINCT english FROM student;</code></li>
<li>在所有学生数学分数上加10分特长分。<br><code>SELECT name,math+10 FROM student;</code></li>
<li>统计每个学生的总分。<br><code>SELECT name,chinese+english+math FROM student;</code></li>
<li>使用别名表示学生分数<br><code>SELECT name AS 姓名,chinese+english+math 总分 FROM student;</code></li>
<li>查询姓名为王五的学生成绩<br><code>SELECT * FROM student WHERE name=&#39;王五&#39;;</code></li>
<li>查询英语成绩大于90分的同学<br><code>SELECT * FROM student WHERE english&gt;90;</code></li>
<li>查询总分大于200分的所有同学<br><code>SELECT * FROM student WHERE (chinese+english+math)&gt;200;</code></li>
<li>查询英语分数在 80－90之间的同学。<br><code>SELECT * FROM student WHERE english BETWEEN 80 AND 90;</code></li>
<li>查询数学分数为89,90,91的同学。<br><code>SELECT * FROM student WHERE math IN (89,90,91);</code></li>
<li>查询所有姓李的学生成绩。<br><code>SELECT * FROM student WHERE name LIKE &#39;李%&#39;;</code></li>
<li>查询数学分&gt;80，语文分&gt;80的同学。<br><code>SELECT * FROM student WHERE math&gt;80 AND chinese&gt;80;</code></li>
<li>对数学成绩排序后输出。<br><code>SELECT name,math FROM student ORDER by math;</code></li>
<li>对总分排序后输出，然后再按从高到低的顺序输出<br><code>SELECT name AS 姓名,chinese+english+math 总分 FROM student ORDER BY 总分 DESC;</code></li>
<li>对姓李的学生成绩排序输出<br><code>SELECT * FROM student WHERE name LIKE &#39;李%&#39; ORDER BY chinese;</code></li>
</ul>
<h1 id="八、数据完整性（很重要）"><a href="#八、数据完整性（很重要）" class="headerlink" title="八、数据完整性（很重要）"></a>八、数据完整性（很重要）</h1><p>数据完整性是为了保证插入到数据中的数据是正确的，它防止了用户可能的输入错误。</p>
<h2 id="1、实体-行-完整性"><a href="#1、实体-行-完整性" class="headerlink" title="1、实体(行)完整性"></a>1、实体(行)完整性</h2><p>规定表的一行（即每一条记录）在表中是唯一的实体。<br>通过定义主键约束来实现。</p>
<ul>
<li>主键：PRIMARY KEY</li>
<li>特点：不能为null，且唯一。</li>
<li>主键：</li>
<li>逻辑主键：比如ID，不代表实际的业务意义，只是用来唯一标识一条记录。（推荐）</li>
<li>业务主键：比如username作为主键。</li>
</ul>
<p><strong>方式一：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t1(</span><br><span class="line">	id int PRIMARY KEY,</span><br><span class="line">	name varchar(100)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>方式二：可以定义联合主键</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t2(</span><br><span class="line">	id int,</span><br><span class="line">	name varchar(100),</span><br><span class="line">	PRIMARY KEY(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>方式三：（推荐）</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t3(</span><br><span class="line">	id int,</span><br><span class="line">	name varchar(100)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>ALTER TABLE t3 ADD PRIMARY KEY (id);</code></p>
<p><code>自动增长的主键：（Oracle没有的）</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t4(</span><br><span class="line">        id int PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	name varchar(100)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>


<h2 id="2、域-列-完整性"><a href="#2、域-列-完整性" class="headerlink" title="2、域(列)完整性"></a>2、域(列)完整性</h2><ul>
<li>指数据库表的列（即字段）必须符合某种特定的数据类型或约束</li>
<li>数据类型</li>
<li>长度</li>
<li>非空约束：NOT NULL</li>
<li>唯一约束：UNIQUE<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t5(</span><br><span class="line">	username varchar(100) NOT NULL UNIQUE,</span><br><span class="line">	gender varchar(100) NOT NULL,</span><br><span class="line">	phonenum varchar(100) UNIQUE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h2 id="3、参照完整性（Hibernate）：多表-外键约束"><a href="#3、参照完整性（Hibernate）：多表-外键约束" class="headerlink" title="3、参照完整性（Hibernate）：多表,外键约束"></a>3、参照完整性（Hibernate）：多表,外键约束</h2></li>
</ul>
<p><strong>多表设计：</strong><br><strong>一对多：（最多，最复杂）</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE customers(</span><br><span class="line">	id int,</span><br><span class="line">	name varchar(100),</span><br><span class="line">	address varchar(255),</span><br><span class="line">	PRIMARY KEY(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE TABLE orders(</span><br><span class="line">	id int PRIMARY KEY,</span><br><span class="line">	order_num varchar(100),</span><br><span class="line">	price float(8,2),</span><br><span class="line">	status int,</span><br><span class="line">	customer_id int,</span><br><span class="line">	CONSTRAINT customer_id_fk FOREIGN KEY(customer_id) REFERENCES customers(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>类和数据库表结构对应，对象和数据库表中的记录对应。</strong></p>
<p><code>类的设计有方向</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class Customer&#123;</span><br><span class="line">	private int id;</span><br><span class="line">	private String name;</span><br><span class="line">	private String address;</span><br><span class="line">	private List&lt;Order&gt; orders &#x3D; new ArrayList&lt;Order&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class Order&#123;</span><br><span class="line">	private int id;</span><br><span class="line">	private String orderNum;</span><br><span class="line">	private float price;</span><br><span class="line">	private int status;</span><br><span class="line">	private Customer customer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>多对多</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE teachers(</span><br><span class="line">	id int PRIMARY KEY,</span><br><span class="line">	name varchar(100),</span><br><span class="line">	salary float(8,2)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE students(</span><br><span class="line">	id int PRIMARY KEY,</span><br><span class="line">	name varchar(100),</span><br><span class="line">	grade varchar(100)</span><br><span class="line">);</span><br><span class="line">CREATE TABLE teacher_student(</span><br><span class="line">	t_id int,</span><br><span class="line">	s_id int,</span><br><span class="line">	PRIMARY KEY(t_id,s_id),</span><br><span class="line">	CONSTRAINT teacher_id_fk FOREIGN KEY(t_id) REFERENCES teachers(id),</span><br><span class="line">	CONSTRAINT student_id_fk FOREIGN KEY(s_id) REFERENCES students(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>类如何设计：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class Teacher&#123;&#x2F;&#x2F;多对多</span><br><span class="line">	private int id;</span><br><span class="line">	private String name;</span><br><span class="line">	private float salary;</span><br><span class="line">	private List&lt;Student&gt; students;</span><br><span class="line">&#125;</span><br><span class="line">public class Student&#123;</span><br><span class="line">	private int id;</span><br><span class="line">	private String name;</span><br><span class="line">	private String grade;</span><br><span class="line">	private List&lt;Teacher&gt; teachers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一对一省略    </p>
<h1 id="九、多表查询"><a href="#九、多表查询" class="headerlink" title="九、多表查询"></a>九、多表查询</h1><h2 id="1、链接查询：（面试几率灰常大）"><a href="#1、链接查询：（面试几率灰常大）" class="headerlink" title="1、链接查询：（面试几率灰常大）"></a>1、链接查询：（面试几率灰常大）</h2><ul>
<li>a、交叉链接：<br><code>SELECT * FROM customers,orders;</code><br>返回的是两张表记录的笛卡尔积。(隐式查询：不使用关键字)<br>或者<br><code>SELECT * FROM customers CROSS JOIN orders;</code></li>
<li>b、内连接：<br><code>SELECT * FROM customers c,orders o WHERE c.id=o.customer_id;</code><br>或者<br><code>SELECT * FROM customers c INNER JOIN orders o ON c.id=o.customer_id;</code></li>
<li>c、外连接：<br>查询所有的客户信息，同时把对应的订单查询出来。<ul>
<li>左外：返回符合链接条件的记录，同时返回左表中不满足链接条件的剩余记录<br><code>SELECT * FROM customers c LEFT OUTER JOIN orders o ON c.id=o.customer_id;</code></li>
<li>右外：<br><code>SELECT * FROM customers c RIGHT JOIN orders o ON c.id=o.customer_id;</code></li>
</ul>
</li>
</ul>
<h2 id="2、几个简单的子查询"><a href="#2、几个简单的子查询" class="headerlink" title="2、几个简单的子查询"></a>2、几个简单的子查询</h2><ul>
<li><p>嵌套查询，子查询的语句放到小括号之内。<br>ID=1的这个老师教过哪些学员(语句的查询形式：多条SQL语句)<br><code>SELECT s_id FROM teacher_student WHERE t_id=1;</code><br><code>SELECT * FROM students WHERE id IN (1,2);</code></p>
</li>
<li><p>子查询：<br><code>SELECT * FROM students WHERE id IN (SELECT s_id FROM teacher_student WHERE t_id=1);</code></p>
<h1 id="十、分组统计"><a href="#十、分组统计" class="headerlink" title="十、分组统计"></a>十、分组统计</h1></li>
<li><p>统计一个班级共有多少学生？<br><code>SELECT COUNT(*) FROM student;</code></p>
</li>
<li><p>统计数学成绩大于90的学生有多少个？<br><code>SELECT COUNT(*) FROM student WHERE math&gt;90;</code></p>
</li>
<li><p>统计总分大于250的人数有多少？<br><code>SELECT COUNT(*) FROM student WHERE (chinese+english+math)&gt;250;</code></p>
</li>
<li><p>统计一个班级数学总成绩？<br><code>SELECT SUM(math) FROM student;</code></p>
</li>
<li><p>统计一个班级语文、英语、数学各科的总成绩<br><code>SELECT SUM(chinese),SUM(english),SUM(math) FROM student;</code></p>
</li>
<li><p>统计一个班级语文、英语、数学的成绩总和<br><code>SELECT SUM(chinese+english+math) FROM student;</code></p>
</li>
<li><p>统计一个班级语文成绩平均分<br><code>SELECT SUM(chinese)/COUNT(*) FROM student;</code></p>
</li>
<li><p>求一个班级数学平均分？<br><code>SELECT AVG(math) FROM student;//不会包含为null</code></p>
</li>
<li><p>求一个班级总分平均分<br><code>SELECT AVG(chinese+english+math) FROM student;</code></p>
</li>
</ul>
<p><strong><em>注意：可以使用 ` 反引号把关键字包含起来，当做普通字符串对待。</em></strong></p>
<ul>
<li>对订单表中商品归类后，显示每一类商品的总价<br><code>SELECT product,SUM(price) FROM t_order GROUP BY product;</code></li>
<li>查询购买了几类商品，并且每类总价大于100的商品<br><code>SELECT product,SUM(price) FROM t_order GROUP BY product HAVING SUM(price)&gt;100;</code></li>
</ul>
<h1 id="十一、MySQL备份与恢复"><a href="#十一、MySQL备份与恢复" class="headerlink" title="十一、MySQL备份与恢复"></a>十一、MySQL备份与恢复</h1><p><code>备份：</code><br><code>c:/&gt;mysqldump -h localhost -u root -p mydb1&gt;d:/mydb1.sql</code></p>
<p><code>恢复：</code><br>先创建数据库名，并选择数据库</p>
<ul>
<li>方式一：<br><code>mysql&gt;SOURCE d:/mydb1.sql;</code></li>
<li>方式二：<br><code>c:/&gt;mysql -u root -p test&lt;d:/mydb1.sql</code></li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-mysql/mysql-关于时间、日期的总结"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/11/mysql/mysql-%E5%85%B3%E4%BA%8E%E6%97%B6%E9%97%B4%E3%80%81%E6%97%A5%E6%9C%9F%E7%9A%84%E6%80%BB%E7%BB%93/"
    >mysql-关于时间、日期的总结</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/11/mysql/mysql-%E5%85%B3%E4%BA%8E%E6%97%B6%E9%97%B4%E3%80%81%E6%97%A5%E6%9C%9F%E7%9A%84%E6%80%BB%E7%BB%93/" class="article-date">
  <time datetime="2020-07-11T14:36:00.000Z" itemprop="datePublished">2020-07-11</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="1-CURRENT-DATE"><a href="#1-CURRENT-DATE" class="headerlink" title="1.CURRENT_DATE"></a>1.CURRENT_DATE</h1><p><strong>CURDATE()、CURRENT_DATE()、CURRENT_DATE</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT CURDATE(),CURRENT_DATE(),CURRENT_DATE;</span><br></pre></td></tr></table></figure>
<p><strong>结果：</strong><br><img src="https://upload-images.jianshu.io/upload_images/19382524-f83c2e4cf4c64bd5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h1 id="2-CURRENT-TIME"><a href="#2-CURRENT-TIME" class="headerlink" title="2.CURRENT_TIME"></a>2.CURRENT_TIME</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT CURRENT_TIME,CURRENT_TIME();</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-e98c8caf703300be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=" result"></p>
<h1 id="3-DATETIME-、TIMESTAMP、LOCALTIMESTAMP"><a href="#3-DATETIME-、TIMESTAMP、LOCALTIMESTAMP" class="headerlink" title="3.DATETIME 、TIMESTAMP、LOCALTIMESTAMP"></a>3.DATETIME 、TIMESTAMP、LOCALTIMESTAMP</h1><p><strong>NOW()、SYSDATE()、CURRENT_TIMESTAMP、CURRENT_TIMESTAMP()、LOCALTIME、LOCALTIME()、LOCALTIMESTAMP、LOCALTIMESTAMP()</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT NOW(),SYSDATE(),CURRENT_TIMESTAMP,CURRENT_TIMESTAMP(),LOCALTIME,LOCALTIME(),LOCALTIMESTAMP,LOCALTIMESTAMP();</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-9a348e4e02dcf70d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h1 id="4-获得当前-UTC-日期时间函数：utc-date-utc-time-utc-timestamp"><a href="#4-获得当前-UTC-日期时间函数：utc-date-utc-time-utc-timestamp" class="headerlink" title="4.获得当前 UTC 日期时间函数：utc_date(), utc_time(), utc_timestamp()"></a>4.获得当前 UTC 日期时间函数：utc_date(), utc_time(), utc_timestamp()</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT UTC_DATE(), UTC_TIME(), UTC_TIMESTAMP(),UTC_DATE,UTC_TIME,UTC_TIMESTAMP;</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-1bf65131de873ee5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h1 id="5-NOW-与SYSDATE-区别"><a href="#5-NOW-与SYSDATE-区别" class="headerlink" title="5. NOW()与SYSDATE() 区别"></a>5. NOW()与SYSDATE() 区别</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT NOW(),SLEEP(1),NOW();</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-6ba210b4353e41bb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT SYSDATE(),SLEEP(1),SYSDATE();</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-8a674bc82aef1d5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<p><strong>总结：</strong> now() 在执行开始时值就得到了， sysdate() 在函数执行时动态得到值。真正的系统时间，不受mysql 的SLEEP()等函数的影响。</p>
<h1 id="6-格式化日期-（日期转字符串）-DATE-FORMAT-date-format"><a href="#6-格式化日期-（日期转字符串）-DATE-FORMAT-date-format" class="headerlink" title="6. 格式化日期 （日期转字符串） DATE_FORMAT(date, format)"></a>6. 格式化日期 （日期转字符串） DATE_FORMAT(date, format)</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE_FORMAT(NOW(),&quot;%Y年%m月%d日 %H:%i:%s or %T&quot;);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-43ca54b771cd8373.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<p><strong>format字符串格式化date值如下:</strong></p>
<ul>
<li>%S, %s 两位数字形式的秒（ 00,01, …, 59）</li>
<li>%I, %i 两位数字形式的分（ 00,01, …, 59）</li>
<li>%H 两位数字形式的小时，24 小时（00,01, …, 23）</li>
<li>%h 两位数字形式的小时，12 小时（01,02, …, 12）</li>
<li>%k 数字形式的小时，24 小时（0,1, …, 23）</li>
<li>%l 数字形式的小时，12 小时（1, 2, …, 12）</li>
<li>%T 24 小时的时间形式（hh:mm:ss）</li>
<li>%r 12 小时的时间形式（hh:mm:ss AM 或hh:mm:ss PM）</li>
<li>%p AM或PM</li>
<li>%W 一周中每一天的名称（Sunday, Monday, …, Saturday）</li>
<li>%a 一周中每一天名称的缩写（Sun, Mon, …, Sat）</li>
<li>%d 两位数字表示月中的天数（00, 01,…, 31）</li>
<li>%e 数字形式表示月中的天数（1, 2， …, 31）</li>
<li>%D 英文后缀表示月中的天数（1st, 2nd, 3rd,…）</li>
<li>%w 以数字形式表示周中的天数（ 0 = Sunday, 1=Monday, …, 6=Saturday）</li>
<li>%j 以三位数字表示年中的天数（ 001, 002, …, 366）</li>
<li>%U 周（0, 1, 52），其中Sunday 为周中的第一天</li>
<li>%u 周（0, 1, 52），其中Monday 为周中的第一天</li>
<li>%M 月名（January, February, …, December）</li>
<li>%b 缩写的月名（ January, February,…., December）</li>
<li>%m 两位数字表示的月份（01, 02, …, 12）</li>
<li>%c 数字表示的月份（1, 2, …., 12）</li>
<li>%Y 四位数字表示的年份</li>
<li>%y 两位数字表示的年份</li>
<li>%% 直接值“%”</li>
</ul>
<hr>
<h2 id="6-2-STR-TO-DATE（字符串转日期）"><a href="#6-2-STR-TO-DATE（字符串转日期）" class="headerlink" title="6.2 STR_TO_DATE（字符串转日期）"></a>6.2 STR_TO_DATE（字符串转日期）</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT STR_TO_DATE(&quot;5月30号 2019年&quot;,&quot;%m月%d号 %Y年&quot;)</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-b496aa4c902a7df2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h1 id="7-选取日期时间的各个部分"><a href="#7-选取日期时间的各个部分" class="headerlink" title="7.选取日期时间的各个部分"></a>7.选取日期时间的各个部分</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT NOW(),date(NOW()),time(NOW()),year(NOW()),quarter(NOW()),month(NOW()),week(NOW()),day(NOW()),hour(NOW()),minute(NOW()),second(NOW());</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-ceb34d593a6d55ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT YEAR(&#39;2019&#x2F;09&#x2F;10 12:13:14&#39;),MONTH(&#39;2019-09-10 12:13:14&#39;),DAY(&#39;2019-09-10 12:13:14&#39;),HOUR(&#39;2019-09-10 12:13:14&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-83279345ca9463c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<p><strong>选取日期函数如下：</strong></p>
<ul>
<li>date(date);</li>
<li>time(date);</li>
<li>year(date);</li>
<li>quarter(date);</li>
<li>month(date);</li>
<li>week(date);</li>
<li>day(date);</li>
<li>hour(date);</li>
<li>minute(date);</li>
<li>second(date);</li>
<li>microsecond(date);</li>
</ul>
<h1 id="8-MySQL-Extract-函数"><a href="#8-MySQL-Extract-函数" class="headerlink" title="8.MySQL Extract() 函数"></a>8.MySQL Extract() 函数</h1><ul>
<li>extract(year from date);</li>
<li>extract(quarter from date);</li>
<li>extract(month from date);</li>
<li>extract(week from date);</li>
<li>extract(day from date);</li>
<li>extract(hour from date);</li>
<li>extract(minute from date);</li>
<li>extract(second from date);</li>
<li>extract(microsecond from date);</li>
<li>extract(year_month from date);</li>
<li>extract(day_hour from date);</li>
<li>extract(day_minute from date);</li>
<li>extract(day_second from date);</li>
<li>extract(day_microsecond from date);</li>
<li>extract(hour_minute from date);</li>
<li>extract(hour_second from date);</li>
<li>extract(hour_microsecond from date);</li>
<li>extract(minute_second from date);</li>
<li>extract(minute_microsecond from date);</li>
<li>extract(second_microsecond from date);</li>
</ul>
<p><strong>注意：</strong>MySQL Extract() 函数除了没有date(),time()的功能外，其他功能一应具全。并且还具有选取‘day_microsecond’等功能。注意这里不是只选取 day 和 microsecond，而是从日期的 day 部分一直选取到 microsecond 部分</p>
<h1 id="9-dayofweek-dayofmonth-dayofyear-…"><a href="#9-dayofweek-dayofmonth-dayofyear-…" class="headerlink" title="9.dayofweek(), dayofmonth(), dayofyear()…"></a>9.dayofweek(), dayofmonth(), dayofyear()…</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT dayofweek(NOW()),dayofmonth(NOW()), dayofyear(NOW());</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-c695660b71764000.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<h2 id="9-2-MySQL-week…-函数：week-weekofyear-dayofweek-weekday-yearweek"><a href="#9-2-MySQL-week…-函数：week-weekofyear-dayofweek-weekday-yearweek" class="headerlink" title="9.2 MySQL week… 函数：week(), weekofyear(), dayofweek(), weekday(), yearweek()"></a>9.2 MySQL week… 函数：week(), weekofyear(), dayofweek(), weekday(), yearweek()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT WEEK(NOW()),WEEKOFYEAR(NOW()) ,weekday(NOW()),dayofweek(NOW()), yearweek(NOW());</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-475e9560e0d020ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<p><em>MySQL week() 函数，可以有两个参数，具体可看手册。 weekofyear() 和 week() 一样，都是计算“某天”是位于一年中的第几周。 weekofyear(@dt) 等价于 week(@dt,3)。<br>MySQL weekday()函数和dayofweek()类似，都是返回“某天”在一周中的位置。不同点在于参考的标准， weekday：(0 =Monday, 1 = Tuesday, …, 6 = Sunday)； dayofweek：（1 = Sunday, 2 = Monday,…, 7 = Saturday）</em></p>
<p><strong>WEEK(date[,mode])函数:</strong></p>
<table>
<thead>
<tr>
<th align="center">Mode</th>
<th align="center">一个星期的第一天</th>
<th align="center">范围</th>
<th align="center">Week 1 是第一个星期</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">Sunday</td>
<td align="center">0-53</td>
<td align="center">with a Sunday in this year</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">Monday</td>
<td align="center">0-53</td>
<td align="center">with more than 3 days this year</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">Sunday</td>
<td align="center">1-53</td>
<td align="center">with a Sunday in this year</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">Monday</td>
<td align="center">1-53</td>
<td align="center">with more than 3 days this year</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">Sunday</td>
<td align="center">0-53</td>
<td align="center">with more than 3 days this year</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">Monday</td>
<td align="center">0-53</td>
<td align="center">with a Monday in this year</td>
</tr>
<tr>
<td align="center">6</td>
<td align="center">Sunday</td>
<td align="center">1-53</td>
<td align="center">with more than 3 days this year</td>
</tr>
<tr>
<td align="center">7</td>
<td align="center">Monday</td>
<td align="center">1-53</td>
<td align="center">with a Monday in this year</td>
</tr>
</tbody></table>
<p><strong>如：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT weekofyear(NOW()),week(NOW(),3),week(NOW())</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-30aa33fbd055b2e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h2 id="9-3-MySQL-返回星期和月份名称函数：dayname-monthname"><a href="#9-3-MySQL-返回星期和月份名称函数：dayname-monthname" class="headerlink" title="9.3 MySQL 返回星期和月份名称函数：dayname(), monthname()"></a>9.3 MySQL 返回星期和月份名称函数：dayname(), monthname()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT dayname(NOW()),monthname(NOW())</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-0734bea99af7a8b2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h1 id="10-msyql增加日期date-add-，减少日期date-sub"><a href="#10-msyql增加日期date-add-，减少日期date-sub" class="headerlink" title="10 msyql增加日期date_add() ，减少日期date_sub()"></a>10 msyql增加日期date_add() ，减少日期date_sub()</h1><p><em>date_add() 可以替换adddate(),addtime()</em><br><em>date_sub()可以替换subdate(), subtime()</em><br><em>建议使用date_add() 和date_sub()</em></p>
<p>增加1天1小时1分1秒</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT date_add(&quot;2000-2-2&quot;,interval &quot;1 1:1:1&quot; DAY_SECOND)</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-1d0349dddb255bd7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<p>对照表data(date,interval expr unit)<br><img src="https://upload-images.jianshu.io/upload_images/19382524-3f7323f212905016.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mysql.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT date_add(&quot;2000-2-2&quot;,interval &quot;-1 -1:-1:-1&quot; DAY_SECOND)</span><br><span class="line">相同</span><br><span class="line">SELECT date_sub(&quot;2000-2-2&quot;,interval &quot;1 1:1:1&quot; DAY_SECOND)</span><br></pre></td></tr></table></figure>
<p>date_sub()与date_add()类似，不再赘述</p>
<h1 id="11-MySQL-日期函数：period-add-P-N-period-diff-P1-P2"><a href="#11-MySQL-日期函数：period-add-P-N-period-diff-P1-P2" class="headerlink" title="11.MySQL 日期函数：period_add(P,N), period_diff(P1,P2)"></a>11.MySQL 日期函数：period_add(P,N), period_diff(P1,P2)</h1><p><em>函数参数“P” 的格式为“YYYYMM” 或者 “YYMM”，第二个参数“N” 表示增加或减去 N month（月）。</em></p>
<p><strong>日期加/减去N月</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select period_add(20190202,1), period_add(20190202,-1);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-b02a87b59fa96e21.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<hr>
<p><strong>日期 P1-P2，返回 N 个月</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select period_diff(201901, 201905);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-7ede64103d4aac80.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<p>MySQL 日期、时间相减函数：datediff(date1,date2), timediff(time1,time2)</p>
<h2 id="11-2-MySQL-日期、时间相减函数：datediff-date1-date2-timediff-time1-time2"><a href="#11-2-MySQL-日期、时间相减函数：datediff-date1-date2-timediff-time1-time2" class="headerlink" title="11.2 .MySQL 日期、时间相减函数：datediff(date1,date2), timediff(time1,time2)"></a>11.2 .MySQL 日期、时间相减函数：datediff(date1,date2), timediff(time1,time2)</h2><p><strong>两个日期相减 date1 - date2返回天数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select datediff(&#39;20190101&#39;, &#39;20190201&#39;);</span><br><span class="line">select datediff(&#39;2019-01-01&#39;, &#39;2019-02-01&#39;)</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-fb59144db42a260a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h2 id="11-3-转换函数：time-to-sec-time-sec-to-time-seconds"><a href="#11-3-转换函数：time-to-sec-time-sec-to-time-seconds" class="headerlink" title="11.3 转换函数：time_to_sec(time), sec_to_time(seconds)"></a>11.3 转换函数：time_to_sec(time), sec_to_time(seconds)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select time_to_sec(&#39;01:01:01&#39;),sec_to_time(3661);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-5b1baaaeff8b4a99.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h2 id="11-4-转换函数：to-days-date-from-days-days"><a href="#11-4-转换函数：to-days-date-from-days-days" class="headerlink" title="11.4 转换函数：to_days(date), from_days(days)"></a>11.4 转换函数：to_days(date), from_days(days)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select to_days(&#39;2019-01-01&#39;),from_days(737425);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-bf176f5a330da047.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h2 id="11-5-MySQL-获得国家地区时间格式函数：get-format"><a href="#11-5-MySQL-获得国家地区时间格式函数：get-format" class="headerlink" title="11.5 MySQL 获得国家地区时间格式函数：get_format()"></a>11.5 MySQL 获得国家地区时间格式函数：get_format()</h2><p><strong>MySQL get_format() 语法：</strong></p>
<p><em>get_format(date|time|datetime, ‘eur’|’usa’|’jis’|’iso’|’internal’)</em></p>
<p><strong>示例：</strong></p>
<ul>
<li>get_format(date,’usa’) ; – ‘%m.%d.%Y’</li>
<li>get_format(date,’jis’) ; – ‘%Y-%m-%d’</li>
<li>get_format(date,’iso’) ; – ‘%Y-%m-%d’</li>
<li>get_format(date,’eur’) ; – ‘%d.%m.%Y’</li>
<li>get_format(date,’internal’) ; – ‘%Y%m%d’</li>
<li>get_format(datetime,’usa’) ; – ‘%Y-%m-%d %H.%i.%s’</li>
<li>get_format(datetime,’jis’) ; – ‘%Y-%m-%d %H:%i:%s’</li>
<li>get_format(datetime,’iso’) ; – ‘%Y-%m-%d %H:%i:%s’</li>
<li>get_format(datetime,’eur’) ; – ‘%Y-%m-%d %H.%i.%s’</li>
<li>get_format(datetime,’internal’) ; – ‘%Y%m%d%H%i%s’</li>
<li>get_format(time,’usa’) ; – ‘%h:%i:%s %p’</li>
<li>get_format(time,’jis’) ; – ‘%H:%i:%s’</li>
<li>get_format(time,’iso’) ; – ‘%H:%i:%s’</li>
<li>get_format(time,’eur’) ; – ‘%H.%i.%s’</li>
<li>get_format(time,’internal’) ; – ‘%H%i%s’</li>
</ul>
<h2 id="11-6-MySQL-拼凑日期、时间函数：makdedate-year-dayofyear-maketime-hour-minute-second"><a href="#11-6-MySQL-拼凑日期、时间函数：makdedate-year-dayofyear-maketime-hour-minute-second" class="headerlink" title="11.6 MySQL 拼凑日期、时间函数：makdedate(year,dayofyear), maketime(hour,minute,second)"></a>11.6 MySQL 拼凑日期、时间函数：makdedate(year,dayofyear), maketime(hour,minute,second)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select makedate(2019,33),maketime(1,1,1)</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-3c7ff7cfab9557b1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h2 id="11-7-MySQL-（Unix-时间戳、日期）转换函数："><a href="#11-7-MySQL-（Unix-时间戳、日期）转换函数：" class="headerlink" title="11.7 MySQL （Unix 时间戳、日期）转换函数："></a>11.7 MySQL （Unix 时间戳、日期）转换函数：</h2><ul>
<li>unix_timestamp(),</li>
<li>unix_timestamp(date),</li>
<li>from_unixtime(unix_timestamp),</li>
<li>from_unixtime(unix_timestamp,format)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select unix_timestamp(),unix_timestamp(&#39;2019-01-01&#39;),from_unixtime(1570080832),from_unixtime(1570080832, &#39;%Y %D %M %h:%i:%s %x&#39;);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-4c75c5ecac896877.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<h2 id="11-8-MySQL-时间戳（timestamp）转换、增、减函数"><a href="#11-8-MySQL-时间戳（timestamp）转换、增、减函数" class="headerlink" title="11.8 MySQL 时间戳（timestamp）转换、增、减函数"></a>11.8 MySQL 时间戳（timestamp）转换、增、减函数</h2><ul>
<li>timestamp(date) – date to timestamp</li>
<li>timestamp(datetime,time) – datetime + time</li>
<li>timestampadd(interval,int_expr,datetime_expr)</li>
<li>timestampdiff(interval,datetime_expr1,datetime_expr2)</li>
</ul>
<p><strong>interval 参数:</strong></p>
<ul>
<li>FRAC_SECOND：表示间隔是毫秒</li>
<li>SECOND：秒</li>
<li>MINUTE：分钟</li>
<li>HOUR：小时</li>
<li>DAY：天</li>
<li>WEEK：星期</li>
<li>MONTH：月</li>
<li>QUARTER：季度</li>
<li>YEAR：年</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select timestamp(&#39;2000-01-01&#39;),timestamp(&#39;2000-01-01 01:00:00&#39;, &#39;01:01:01&#39;),timestamp(&#39;2000-01-01 01:00:00&#39;, &#39;01 01:01:01&#39;),timestampadd(day, 1, &#39;2000-01-01 01:00:00&#39;);</span><br></pre></td></tr></table></figure>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-194940439867b59a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<p><strong>MySQL timestampadd() 函数类似于 date_add()</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select timestampadd(day, 1, &#39;2000-01-01 01:00:00&#39;), date_add(&#39;2000-01-01 01:00:00&#39;, interval 1 day);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-2f82c08279b4368a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select timestampdiff(year,&#39;2000-01-01&#39;,&#39;2001-01-11&#39;),datediff(&#39;2000-02-01&#39;,&#39;2000-01-01&#39;);</span><br></pre></td></tr></table></figure>

<p><img src="https://upload-images.jianshu.io/upload_images/19382524-0539e8438139b674.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="result"></p>
<p><em>MySQL timestampdiff() 函数就比 datediff() 功能强多了，datediff() 只能计算两个日期（date）之间相差的天数</em></p>
<h1 id="12-生产示例"><a href="#12-生产示例" class="headerlink" title="12. 生产示例"></a>12. 生产示例</h1><h2 id="12-1"><a href="#12-1" class="headerlink" title="12.1"></a>12.1</h2><p><em>t_order.sql</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;t_order&#96;  (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT COMMENT &#39;订单id&#39;,</span><br><span class="line">  &#96;name&#96; varchar(50) CHARACTER SET utf8 COLLATE utf8_general_ci DEFAULT NULL COMMENT &#39;订单名称&#39;,</span><br><span class="line">  &#96;createTime&#96; datetime(0) DEFAULT NULL COMMENT &#39;创建时间&#39;,</span><br><span class="line">  &#96;count&#96; int(11) DEFAULT NULL COMMENT &#39;订单数量&#39;,</span><br><span class="line">  PRIMARY KEY (&#96;id&#96;) USING BTREE</span><br><span class="line">) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 11 CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;</span><br><span class="line"></span><br><span class="line">-- ----------------------------</span><br><span class="line">-- Records of t_order</span><br><span class="line">-- ----------------------------</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (1, &#39;订单1&#39;, &#39;2016-02-02 14:02:59&#39;, 10);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (2, &#39;订单2&#39;, &#39;2016-04-01 14:02:59&#39;, 100);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (3, &#39;订单3&#39;, &#39;2016-07-08 14:02:59&#39;, 200);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (4, &#39;订单4&#39;, &#39;2018-01-01 14:06:06&#39;, 100);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (5, &#39;订单5&#39;, &#39;2019-01-01 14:02:59&#39;, 123);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (6, &#39;订单6&#39;, &#39;2019-04-30 14:02:59&#39;, 45);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (7, &#39;订单7&#39;, &#39;2019-09-25 14:02:59&#39;, 66);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (8, &#39;订单8&#39;, &#39;2019-11-11 14:02:59&#39;, 33);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (9, &#39;订单9&#39;, &#39;2019-12-18 14:02:59&#39;, 26);</span><br><span class="line">INSERT INTO &#96;t_order&#96; VALUES (10, &#39;订单10&#39;, &#39;2019-10-24 14:04:44&#39;, 26);</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">1. 查询2018-01-01后的订单包括2018-01-01</span><br><span class="line">SELECT * FROM t_order where createTime&gt;&#x3D;&quot;2018-01-01&quot;</span><br><span class="line"></span><br><span class="line">2.查询2018-01-01后的订单包括2018-01-01总数量</span><br><span class="line">SELECT SUM(count) FROM t_order where createTime&gt;&#x3D;&quot;2018-01-01&quot; </span><br><span class="line"></span><br><span class="line">3.查询每年的订单</span><br><span class="line">- MySQL: SUBSTR( ), SUBSTRING( )</span><br><span class="line">- Oracle: SUBSTR( )</span><br><span class="line">- SQL Server: SUBSTRING( )</span><br><span class="line"></span><br><span class="line">SELECT SUBSTR(createTime,1,4),SUM(count) FROM t_order  GROUP  BY SUBSTR(createTime,1,4)</span><br><span class="line">SELECT YEAR(createTime),SUM(count) FROM t_order  GROUP  BY YEAR(createTime)</span><br><span class="line"></span><br><span class="line">4.统计2019年每个月的订单数</span><br><span class="line">SELECT MONTH(createTime),SUM(count) FROM t_order  where YEAR(createTime)&#x3D;&quot;2019&quot; GROUP BY MONTH(createTime)</span><br><span class="line">SELECT SUBSTR(createTime,1,7),SUM(count) FROM t_order  where YEAR(createTime)&#x3D;&quot;2019&quot; GROUP BY SUBSTR(createTime,1,7)</span><br><span class="line">SELECT MONTH(createTime),SUM(count) FROM t_order  where YEAR(createTime)&#x3D;&quot;2019&quot; GROUP BY MONTH(createTime)</span><br><span class="line">SELECT SUBSTR(createTime,6,2),SUM(count) FROM t_order  where YEAR(createTime)&#x3D;&quot;2019&quot; GROUP BY SUBSTR(createTime,6,2)</span><br><span class="line">SELECT CONCAT( YEAR ( createTime ), &quot;年&quot;, MONTH ( createTime ), &quot;月&quot; ),SUM( count ) FROM t_order WHERE YEAR ( createTime ) &#x3D; &quot;2019&quot; GROUP BY CONCAT( YEAR ( createTime ), &quot;年&quot;, MONTH ( createTime ), &quot;月&quot; )</span><br><span class="line"></span><br><span class="line">5.统计2019年每个季度的订单数</span><br><span class="line">SELECT QUARTER(createTime),SUM(count) FROM t_order  where YEAR(createTime)&#x3D;&quot;2019&quot; GROUP BY QUARTER(createTime)</span><br><span class="line"></span><br><span class="line">6.按天统计</span><br><span class="line">SELECT CONCAT(YEAR(createTime),&quot;-&quot;,MONTH(createTime),&quot;-&quot;,DAY(createTime)),SUM(count) FROM t_order GROUP BY CONCAT(YEAR(createTime),&quot;-&quot;,MONTH(createTime),&quot;-&quot;,DAY(createTime))</span><br><span class="line">SELECT SUBSTR(createTime,1,10),SUM(count) FROM t_order GROUP BY SUBSTR(createTime,1,10)</span><br></pre></td></tr></table></figure>




<p>参考博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/thinktik/article/details/80993948">MySQL 有关当前日期及日期格式的操作(大全)</a></p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-mysql/mysql的inner-join,left-jion,right-join,cross-join以及on和where的区别"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/10/mysql/mysql%E7%9A%84inner-join,left-jion,right-join,cross-join%E4%BB%A5%E5%8F%8Aon%E5%92%8Cwhere%E7%9A%84%E5%8C%BA%E5%88%AB/"
    >mysql的inner-join,left-jion,right-join,cross-join以及on和where的区别</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/10/mysql/mysql%E7%9A%84inner-join,left-jion,right-join,cross-join%E4%BB%A5%E5%8F%8Aon%E5%92%8Cwhere%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time datetime="2020-07-10T14:36:00.000Z" itemprop="datePublished">2020-07-10</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="建立两个模拟表student表和course表"><a href="#建立两个模拟表student表和course表" class="headerlink" title="建立两个模拟表student表和course表"></a>建立两个模拟表student表和course表</h1><p><img src="https://upload-images.jianshu.io/upload_images/19382524-573d80a1f28d2927.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="student和course表.jpg"></p>
<h1 id="1-cross-join"><a href="#1-cross-join" class="headerlink" title="1.cross join"></a>1.cross join</h1><p>A表和B表求乘积（即笛卡尔积）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from student ,course ;</span><br><span class="line">等于</span><br><span class="line">select * from student  CROSS JOIN  course ;</span><br></pre></td></tr></table></figure>

<p>查询的是笛卡尔乘积student（5）Xcourse(4)=20条</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from student  cross join  course on  student.id &#x3D; course.student_id;</span><br><span class="line">相同</span><br><span class="line">select * from student , course where  student.id &#x3D; course.student_id;</span><br></pre></td></tr></table></figure>
<p>查询结果是：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-1ffd152fb9907b88.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="cross join on 结果集.jpg"></p>
<p>所有限制条件where是通用的<br>而on只能运用于配合各种join查询</p>
<h1 id="2-inner-join"><a href="#2-inner-join" class="headerlink" title="2. inner join"></a>2. inner join</h1><p>在没有限制条件的情况下相同</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from student  inner join course ;</span><br><span class="line">等于</span><br><span class="line">select * from student ,course ;</span><br><span class="line">等于</span><br><span class="line">select * from student  CROSS JOIN  course ;</span><br></pre></td></tr></table></figure>
<p>都是取得20条记录</p>
<p>限制条件下与cross基本相同。<br>即</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select * from student  cross join  course on  student.id &#x3D; course.student_id;</span><br><span class="line">相同</span><br><span class="line">select * from student , course where  student.id &#x3D; course.student_id;</span><br><span class="line">相同</span><br><span class="line">select * from student inner join course on  student.id &#x3D; course.student_id;</span><br></pre></td></tr></table></figure>
<h1 id="3-left-join"><a href="#3-left-join" class="headerlink" title="3. left join"></a>3. left join</h1><p>以左表为主，右表不符合条件的补null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student left join course on  student.id &#x3D; course.student_id;</span><br></pre></td></tr></table></figure>
<p>结果<br><img src="https://upload-images.jianshu.io/upload_images/19382524-9180428879a2057b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="left join.jpg"></p>
<h1 id="4-left-join"><a href="#4-left-join" class="headerlink" title="4 left join"></a>4 left join</h1><p>以右表为主，左表不符合条件的补null</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student right join course on  student.id &#x3D; course.student_id;</span><br></pre></td></tr></table></figure>
<p>结果：<br><img src="https://upload-images.jianshu.io/upload_images/19382524-e3f431571625ad01.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="right join.jpg"></p>
<p>左连接可以转成右连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from student left join course on  student.id &#x3D; course.student_id;</span><br><span class="line">相同</span><br><span class="line">select * from  course right join student on  student.id &#x3D; course.student_id;</span><br></pre></td></tr></table></figure>

<h1 id="5-on和where"><a href="#5-on和where" class="headerlink" title="5 on和where"></a>5 on和where</h1><p>on只能和各种连接联合使用select中<br>where可以用在各种语句上select 、insert、update、delete …..</p>
<p><strong>注意</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from student left join course  on 1&#x3D;1 where  student.id &#x3D; course.student_id;</span><br><span class="line">相同</span><br><span class="line">select * from student , course  where  student.id &#x3D; course.student_id;</span><br></pre></td></tr></table></figure>
<p>加上where条件后则不是以左表为主了！</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
    <article
  id="post-maven/maven中的dependencies与dependencyManagement的区别"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2020/07/09/maven/maven%E4%B8%AD%E7%9A%84dependencies%E4%B8%8EdependencyManagement%E7%9A%84%E5%8C%BA%E5%88%AB/"
    >maven中的dependencies与dependencyManagement的区别</a> 
</h2>
 

    </header>
     
    <div class="article-meta">
      <a href="/2020/07/09/maven/maven%E4%B8%AD%E7%9A%84dependencies%E4%B8%8EdependencyManagement%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time datetime="2020-07-09T14:36:00.000Z" itemprop="datePublished">2020-07-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h2 id="实验：结合一个练习项目讲解两者之间的关系"><a href="#实验：结合一个练习项目讲解两者之间的关系" class="headerlink" title="实验：结合一个练习项目讲解两者之间的关系"></a>实验：结合一个练习项目讲解两者之间的关系</h2><h3 id="项目关系图1"><a href="#项目关系图1" class="headerlink" title="项目关系图1"></a>项目关系图1</h3><p><img src="https://upload-images.jianshu.io/upload_images/19382524-11373eb29a00d03b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="项目关系图1.jpg"></p>
<p><img src="https://upload-images.jianshu.io/upload_images/19382524-0e0a821168399283.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="项目关系图2.jpg"></p>
<h2 id="验证：pom文件"><a href="#验证：pom文件" class="headerlink" title="验证：pom文件"></a>验证：pom文件</h2><h3 id="d4cshiro-parent-pom-xml"><a href="#d4cshiro-parent-pom-xml" class="headerlink" title="d4cshiro-parent pom.xml"></a>d4cshiro-parent pom.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.dancer4code.shiro&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;d4cshiro-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;packaging&gt;pom&lt;&#x2F;packaging&gt;</span><br><span class="line">    &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;modules&gt;</span><br><span class="line">        &lt;module&gt;chapter1&lt;&#x2F;module&gt;</span><br><span class="line">        &lt;module&gt;chapter2&lt;&#x2F;module&gt;</span><br><span class="line">    &lt;&#x2F;modules&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;commons.lang3.version&gt;3.8&lt;&#x2F;commons.lang3.version&gt;</span><br><span class="line">        &lt;commons.logging.version&gt;1.2&lt;&#x2F;commons.logging.version&gt;</span><br><span class="line">        &lt;lombok.version&gt;1.18.8&lt;&#x2F;lombok.version&gt;</span><br><span class="line">        &lt;shiro.version&gt;1.4.0&lt;&#x2F;shiro.version&gt;</span><br><span class="line">        &lt;junit.version&gt;4.12&lt;&#x2F;junit.version&gt;</span><br><span class="line">    &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;commons-logging&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-logging&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;commons.logging.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.shiro&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;shiro-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;shiro.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;$&#123;junit.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencyManagement&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;commons-lang3&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;commons.lang3.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;version&gt;$&#123;lombok.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;&#x2F;dependencyManagement&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>


<h3 id="chapter1-pom-xml"><a href="#chapter1-pom-xml" class="headerlink" title="chapter1 pom.xml"></a>chapter1 pom.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;com.dancer4code.shiro&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;d4cshiro-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;!--相对路径，这里默认就是这个路径，不写也行--&gt;</span><br><span class="line">        &lt;relativePath&gt;pom.xml&lt;&#x2F;relativePath&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.dancer4code.shiro&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;chapter-1&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-lang3&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">    </span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="chapter2-pom-xml"><a href="#chapter2-pom-xml" class="headerlink" title="chapter2 pom.xml"></a>chapter2 pom.xml</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot;</span><br><span class="line">         xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">         xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;artifactId&gt;d4cshiro-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;groupId&gt;com.dancer4code.shiro&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;version&gt;1.0.0-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;parent&gt;</span><br><span class="line">    &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;com.dancer4code.shiro&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;chapter-2&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">    &lt;&#x2F;dependencies&gt;</span><br><span class="line">&lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="在idea右侧tab查看最终倒入的相关jar包依赖"><a href="#在idea右侧tab查看最终倒入的相关jar包依赖" class="headerlink" title="在idea右侧tab查看最终倒入的相关jar包依赖"></a>在idea右侧tab查看最终倒入的相关jar包依赖</h3><p><img src="https://upload-images.jianshu.io/upload_images/19382524-8436a778d8b1cb67.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="实际倒入的jar包依赖.jpg"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><em>dedependencies:</em> 由此引入的jar包，子项目中不必显示引入。此项通常引入的是公用jar包。（全部继承）</p>
<p><em>dependencyManagement:</em> 由此引入的jar 需在子项目中显示引入，默认不写<version></version>则引入parent的，若声明<version>则引入自己的。（需声明才继承，按需导入）</p>
<p>两者配合实现了项目版本号的统一管理</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/maven/" rel="tag">maven</a></li></ul>

    </footer>
  </div>

    
 
   
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">上一页</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2020
        <i class="ri-heart-fill heart_icon"></i> d4c
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        由 <a href="https://hexo.io" target="_blank">Hexo</a> 强力驱动
        <span class="division">|</span>
        主题 - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></s>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="D4C的世界"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="https://www.jianshu.com/u/060a97a8dfe1">简书</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <script>
      if (window.matchMedia("(max-width: 768px)").matches) {
        document.querySelector('.content').classList.remove('on');
        document.querySelector('.sidebar').classList.remove('on');
      }
    </script>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css">
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script>

<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->


<script src="/js/busuanzi-2.3.pure.min.js"></script>


<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->


<link rel="stylesheet" href="/css/clipboard.css">

<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>


<!-- CanvasBackground -->


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=357126&auto=0&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
  </div>
</body>

</html>